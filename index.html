<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- FIX: Ensure Referrer matches Origin for Google OAuth -->
    <meta name="referrer" content="no-referrer-when-downgrade">
    <title>Noble Nexus Portal</title>
    <link rel="icon" type="image/x-icon" href="./static/class_bridge_logo.jpg">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary-color: #28245D;
            /* Deep Indigo */
            --secondary-color: #FB7D5B;
            --accent-yellow: #FCC43E;
            --accent-blue: #304FFE;

            --bg-body: #F3F4FF;
            --bg-sidebar: #28245D;
            /* Dark Sidebar */

            --text-main: #303972;
            --text-secondary: #A098AE;
            --text-white: #FFFFFF;
            --text-sidebar-mute: #B9B4C7;

            --sidebar-width: 280px;
        }

        /* RESET & BASICS */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            color: var(--text-main);
            font-weight: 700;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: var(--sidebar-width);
            /* height: 100vh;  Changed to dynamic viewport height for mobile */
            height: 100dvh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            background-color: var(--bg-sidebar);
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            border-right: none;
            overflow: hidden;
            /* Prevent body scroll, handle inside user-controls */
        }

        #user-controls {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 0;
            /* Custom Scrollbar for Sidebar */
            scrollbar-width: thin;
            padding-bottom: 50px;
        }

        /* --- MAIN CONTENT --- */
        #main-content {
            margin-left: var(--sidebar-width);
            padding: 2rem 3rem;
            transition: all 0.3s ease;
        }

        /* MOBILE HEADER START HIDDEN */
        .mobile-header {
            display: none !important;
        }

        @media (max-width: 991px) {
            #sidebar {
                transform: translateX(-100%);
                width: 260px;
            }

            #sidebar.mobile-open {
                transform: translateX(0);
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
            }

            #main-content {
                margin-left: 0;
                padding: 1.5rem;
                padding-top: 5rem;
            }

            .mobile-header {
                display: flex !important;
            }

            .header-bar {
                display: none !important;
            }
        }

        /* --- SEARCH BOX --- */
        .search-box {
            position: relative;
            width: 350px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 50px;
            border-radius: 40px;
            border: none;
            background: #FFFFFF;
            font-family: 'Poppins', sans-serif;
            outline: none;
            color: var(--text-main);
        }

        .search-box .material-icons {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* --- HEADER & USER --- */
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-menu .notify-btn {
            background: #FFFFFF;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            transition: all 0.2s;
        }

        .user-menu .notify-btn:hover {
            background-color: #E6E6F2;
        }

        /* --- SIDEBAR NAV --- */
        /* --- SIDEBAR NAV --- */
        /* --- SIDEBAR NAV --- */
        #sidebar .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            margin-bottom: 4px;
            color: var(--text-sidebar-mute);
            font-weight: 500;
            text-decoration: none;
            border-radius: 6px;
            margin-right: 1rem;
            margin-left: 1rem;
            transition: all 0.2s;
            position: relative;
        }

        #sidebar .nav-item:hover,
        #sidebar .nav-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
        }

        #sidebar .nav-item.active::before {
            display: none;
        }

        #sidebar .nav-item .material-icons {
            font-size: 20px;
            color: var(--text-sidebar-mute);
        }

        #sidebar .nav-item.active .material-icons,
        #sidebar .nav-item:hover .material-icons {
            color: var(--text-white);
        }

        #sidebar .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 2rem;
            padding-left: 1rem;
            text-decoration: none;
        }

        #sidebar .brand .icon {
            background-color: var(--secondary-color);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 24px;
        }

        #sidebar .brand span {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-white);
        }

        /* --- SIDEBAR SUBMENUS --- */
        .nav-submenu {
            display: none;
            flex-direction: column;
            padding-left: 12px;
            margin-bottom: 8px;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }

        .nav-submenu.open {
            display: flex;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-submenu-item {
            padding: 8px 12px 8px 42px;
            /* Indent to align with text of parent */
            font-size: 14px;
            color: var(--text-sidebar-mute);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .nav-submenu-item:hover,
        .nav-submenu-item.active {
            color: var(--text-white);
            background-color: rgba(255, 255, 255, 0.05);
        }

        .nav-item .arrow-icon {
            margin-left: auto;
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .nav-item.expanded .arrow-icon {
            transform: rotate(180deg);
        }

        /* --- WIDGETS --- */
        .metric-widget {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            height: 100%;
            border: 1px solid #E0E0E0;
            box-shadow: none !important;
        }

        .metric-widget:hover {
            border-color: var(--primary-color);
        }

        /* CLASS BRIDGE STYLE WIDGETS */
        .widget-purple {
            background-color: #8D5CF6 !important;
            color: white !important;
        }

        .widget-yellow {
            background-color: #F8C750 !important;
            color: #303972 !important;
        }

        /* Yellow usually has dark text for contrast */
        .widget-blue {
            background-color: #5BA8F5 !important;
            color: white !important;
        }

        .widget-green {
            background-color: #52D884 !important;
            color: white !important;
        }

        .widget-purple .material-icons,
        .widget-blue .material-icons,
        .widget-green .material-icons {
            color: white !important;
        }

        .widget-yellow .material-icons {
            color: #303972 !important;
        }

        .metric-widget h3.number,
        .metric-widget span {
            color: inherit !important;
        }

        .metric-widget .small {
            opacity: 0.8;
        }

        /* HIDE OLD ICON CIRCLES if not needed or restyle them */
        .metric-widget .icon-circle {
            display: none;
        }

        /* New design doesn't use the circle background */

        .metric-widget .icon-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .metric-widget .icon-circle .material-icons {
            font-size: 30px;
        }

        .metric-widget h3.number {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
            color: #303972;
            line-height: 1.2;
        }

        .metric-widget p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 14px;
            text-transform: capitalize !important;
        }

        /* --- CARDS & BUTTONS --- */
        /* Generalized card style for flat look */
        .dashboard-card,
        .card {
            background: #FFFFFF;
            border-radius: 8px !important;
            padding: 24px;
            border: 1px solid #E0E0E0 !important;
            position: relative;
            box-shadow: none !important;
        }

        .shadow-sm {
            box-shadow: none !important;
            border: 1px solid #E0E0E0 !important;
        }

        .h-100-card {
            height: 100%;
        }

        /* Spacing for Roster */
        #roster-table tr td {
            padding-top: 16px;
            padding-bottom: 16px;
        }

        .btn {
            border-radius: 6px;
            font-weight: 500;
            padding: 8px 16px;
            border: none;
        }

        .btn-primary-custom {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary-custom:hover {
            background-color: #3d3499;
            color: white;
        }

        .btn-warning {
            background-color: var(--accent-yellow);
            color: white !important;
        }

        .btn-info {
            background-color: #4CD3C6;
            color: white !important;
        }

        .btn-dark {
            background-color: #303972;
            color: white !important;
        }

        /* --- MODALS --- */
        .modal-content {
            border-radius: 8px;
            border: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            /* Soft shadow for depth, but clean */
        }

        .modal-header,
        .modal-footer {
            border-color: #E0E0E0;
        }

        /* --- LOGIN & UTILS --- */
        body.login-mode {
            background: var(--bg-sidebar);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.login-mode #sidebar,
        body.login-mode .header-bar {
            display: none !important;
        }

        body.login-mode #main-content {
            margin: 0;
            padding: 0;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
            animation: fadeInView 0.4s ease;
            /* Renamed and simplified */
        }

        /* Removed transform to prevent 'position: fixed' containing block issues */
        @keyframes fadeInView {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* ... existing overrides ... */

        /* Login Mode */
        body.login-mode {
            background: var(--bg-sidebar);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.login-mode #sidebar {
            display: none;
        }

        body.login-mode #main-content {
            margin: 0;
            padding: 0;
        }

        .view {
            display: none;
        }

        /* Reuse the simple fade */
        .view.active {
            display: block;
            animation: fadeInView 0.4s;
        }

        /* Redundant keyframes removed */

        /* Pulse Connect Button Styles */
        .pulse-connect-btn {
            position: relative;
            background-color: #0f172a;
            /* Slate 900 */
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            overflow: hidden;
            transition: all 0.3s ease;
            height: 54px;
            /* Fixed height for alignment */
            padding: 2px !important;
            /* Wrapper padding */
        }

        .pulse-connect-btn:hover {
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
            /* Blue glow */
            border-color: rgba(56, 189, 248, 0.5);
        }

        .pulse-connect-btn .inner-ring {
            background-color: #020617;
            /* Slate 950 */
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 10;
        }

        .pulse-connect-btn .gradient-text {
            background: linear-gradient(to right, #d4d4d4, #525252, #d4d4d4);
            /* Neutral gradient text */
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 600;
        }

        /* Subtle radial shine on hover */
        .pulse-connect-btn .absolute-shine {
            position: absolute;
            inset: 0;
            background: radial-gradient(75% 100% at 50% 0%, rgba(56, 189, 248, 0.6) 0%, rgba(56, 189, 248, 0) 75%);
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 1;
        }

        .pulse-connect-btn:hover .absolute-shine {
            opacity: 1;
        }

        /* Mobile */
        @media (max-width: 768px) {
            #sidebar {
                transform: translateX(-100%);
                width: 260px;
            }

            #sidebar.mobile-open {
                transform: translateX(0);
            }

            #main-content {
                margin-left: 0;
                padding: 1rem;
                padding-top: 5rem;
            }
        }

        /* Glassmorphism Styles */
        .glass-navbar {
            transition: all 0.3s ease-in-out;
            border-bottom: 1px solid transparent;
        }

        /* State when scrolled down (Solid Glass) */
        .glass-navbar.scrolled-mode {
            background: rgba(15, 23, 42, 0.85) !important;
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Glass Card Style */
        .glass-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) !important;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15) !important;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .glass-card:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1)) !important;
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.5) !important;
            box-shadow: 0 15px 40px 0 rgba(31, 38, 135, 0.4);
        }

        /* Ensure Text Visibility in Glass Cards */
        .glass-card h5,
        .glass-card p,
        .glass-card .material-icons {
            color: white !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Specific override for the icon circles inside glass cards to be semi-transparent */
        .glass-card .icon-circle {
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        /* --- FADE SLIDE IN ANIMATIONS (Hero) --- */
        @keyframes fade-slide-in {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-slide-in-1 {
            animation: fade-slide-in 0.8s ease-out forwards;
            animation-delay: 0.1s;
            opacity: 0;
        }

        .animate-fade-slide-in-2 {
            animation: fade-slide-in 0.8s ease-out forwards;
            animation-delay: 0.3s;
            opacity: 0;
        }

        .animate-fade-slide-in-3 {
            animation: fade-slide-in 0.8s ease-out forwards;
            animation-delay: 0.5s;
            opacity: 0;
        }

        .animate-fade-slide-in-4 {
            animation: fade-slide-in 0.8s ease-out forwards;
            animation-delay: 0.7s;
            opacity: 0;
        }

        .glass-card:hover .icon-circle {
            background: rgba(255, 255, 255, 0.25) !important;
            transform: scale(1.1);
        }

        .glass-card .icon-circle .material-icons {
            color: white !important;
        }

        .role-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* FIX: Prevent button movement/jitter */
        #landing-view .btn {
            transform: none !important;
            transition: background-color 0.2s, color 0.2s, box-shadow 0.2s !important;
            /* Exclude transform/padding/margin from transition */
            min-width: 100px;
            /* Ensure buttons don't shrink/grow */
        }

        #landing-view .navbar-brand img {
            transition: none !important;
            /* Stop logo from moving */
        }

        /* New Classes for Teachers Section */
        html {
            scroll-behavior: smooth;
        }

        .transform-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .transform-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(77, 68, 181, 0.2) !important;
        }


        /* Glowing Effect Cards (Simplified Occlusion Method) */
        .glowing-card {
            position: relative;
            border-radius: 1.25rem;
            display: block;
            height: 100%;
            /* The 'border' is actually the padding of this container revealing the background div */
            padding: 3px;
            background: transparent;
            z-index: 1;
            /* overflow: hidden; Removed to allow glow to maybe bleed? Keep standard */
            overflow: hidden;
        }

        /* The Content (Top Layer) */
        .glowing-card-content {
            position: relative;
            z-index: 20;
            background: #ffffff;
            border-radius: 1.1rem;
            /* Slightly smaller than parent 1.25rem */
            padding: 1.5rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* The Glowing Background (Bottom Layer) */
        .glowing-card-border {
            position: absolute;
            inset: 0;
            z-index: 10;
            border-radius: inherit;
            pointer-events: none;

            /* Vars */
            --spread: 20;
            --start: 0;
            --active: 0;
            --gradient: radial-gradient(circle, #dd7bbb 10%, #dd7bbb00 20%),
                radial-gradient(circle at 40% 40%, #d79f1e 5%, #d79f1e00 15%),
                radial-gradient(circle at 60% 60%, #5a922c 10%, #5a922c00 20%),
                radial-gradient(circle at 40% 60%, #4c7894 10%, #4c789400 20%),
                repeating-conic-gradient(from 236.84deg at 50% 50%,
                    #dd7bbb 0%,
                    #d79f1e calc(25% / 5),
                    #5a922c calc(50% / 5),
                    #4c7894 calc(75% / 5),
                    #dd7bbb calc(100% / 5));
        }

        .glowing-card-border::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: var(--gradient);
            background-size: 200% 200%;
            /* Ensure gradient covers enough */

            opacity: var(--active);
            /* Controlled by JS hover */
            transition: opacity 0.3s ease;

            /* SEARCHLIGHT MASK: The magic that reveals only a slice */
            /* Using a slightly wider spread and simpler syntax */
            mask-image: conic-gradient(from calc(var(--start) * 1deg - var(--spread) * 1deg),
                    transparent,
                    black,
                    /* Visible part */
                    transparent calc(var(--spread) * 2deg));
            -webkit-mask-image: conic-gradient(from calc(var(--start) * 1deg - var(--spread) * 1deg),
                    transparent,
                    black,
                    transparent calc(var(--spread) * 2deg));
        }


        .glass-card-solid {
            background: #ffffff !important;
            border: 1px solid #eef2f6 !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03) !important;
            border-radius: 12px !important;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .hover-up:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08) !important;
            border-color: var(--primary-color) !important;
        }

        .text-truncate-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
            height: 2.8em;
            /* Force height to align cards */
        }

        .clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Entrance Animation */
        /* Progressive Enhancement: Default is visible. JS adds 'js-scroll-hidden' to hide, then removes it. */
        .fade-in-up {
            transform: translateY(0);
            opacity: 1;
            /* Default visible to prevent "white space" bug if JS fails or lags */
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        /* Logic: JS adds this class initially, then removes it when in view */
        .js-scroll-hidden {
            opacity: 0 !important;
            transform: translateY(30px) !important;
        }

        .fade-in-up.visible {
            opacity: 1;
            /* Redundant but explicit */
            transform: translateY(0);
        }

        /* Stagger delays */
        .delay-100 {
            transition-delay: 0.1s;
        }

        .delay-200 {
            transition-delay: 0.2s;
        }

        .delay-300 {
            transition-delay: 0.3s;
        }

        /* Icon Floating Animation */
        @keyframes float-y {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        .anim-icon {
            display: inline-block;
            animation: float-y 3s ease-in-out infinite;
        }

        /* Different timings for variety */
        .anim-icon-1 {
            animation-delay: 0s;
        }

        .anim-icon-2 {
            animation-delay: 1s;
        }

        .anim-icon-3 {
            animation-delay: 0.5s;
        }

        .dashed-border {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='10' ry='10' stroke='%23ccc' stroke-width='2' stroke-dasharray='10%2c 10' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            border: none !important;
        }

        /* --- SIDEBAR CHATBOT STYLES --- */
        #ai-sidebar {
            position: fixed;
            top: 0;
            right: -450px;
            /* Hidden state */
            width: 450px;
            height: 100vh;
            background: #ffffff;
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.15);
            z-index: 2050;
            /* Highest priority */
            transition: right 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            border-left: 1px solid rgba(0, 0, 0, 0.05);
        }

        #ai-sidebar.open {
            right: 0;
        }

        .chat-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #f0f0f0;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .chat-message {
            max-width: 90%;
            padding: 14px 18px;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.user {
            align-self: flex-end;
            background: #4D44B5;
            /* Brand color */
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-message.ai {
            align-self: flex-start;
            background: #f8f9fa;
            border: 1px solid #edf2f7;
            color: #334155;
            border-bottom-left-radius: 4px;
        }

        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #f0f0f0;
        }

        .chat-toggle-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #4D44B5;
            /* Brand color */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(77, 68, 181, 0.4);
            cursor: pointer;
            z-index: 2040;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid white;
        }

        .chat-toggle-btn:hover {
            transform: scale(1.1) rotate(-5deg);
        }

        /* Markdown Styles inside AI response */
        .chat-message.ai h1,
        .chat-message.ai h2,
        .chat-message.ai h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 12px;
            margin-bottom: 8px;
            color: #1e293b;
        }

        .chat-message.ai p {
            margin-bottom: 10px;
        }

        .chat-message.ai ul,
        .chat-message.ai ol {
            padding-left: 24px;
            margin-bottom: 12px;
        }

        .chat-message.ai li {
            margin-bottom: 4px;
        }

        .chat-message.ai code {
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #d63384;
        }

        .chat-message.ai pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            font-size: 0.85em;
        }

        .chat-message.ai blockquote {
            border-left: 4px solid #cbd5e1;
            padding-left: 12px;
            margin-left: 0;
            color: #64748b;
            font-style: italic;
        }

        .chat-message.ai table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 0.9em;
        }

        .chat-message.ai th,
        .chat-message.ai td {
            border: 1px solid #cbd5e1;
            padding: 8px 12px;
        }

        .chat-message.ai th {
            background-color: #f1f5f9;
            font-weight: 600;
            text-align: left;
        }
    </style>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Microsoft Authentication Library (MSAL) -->
    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <!-- Three.js for Shader Animation (Optional now) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GSAP for Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Ensure GSAP is loaded before script.js -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Observer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body class="login-mode">
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <nav id="sidebar">
        <a href="#" class="brand d-flex align-items-center gap-2 text-decoration-none">
            <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'" alt="Logo"
                style="width: 45px; height: 45px; border-radius: 12px; object-fit: cover;">
            <div class="d-flex flex-column lh-1">
                <span class="fw-bold fs-5 text-white">Class Bridge</span>
                <span class="text-white opacity-50 text-uppercase"
                    style="font-size: 0.55rem; letter-spacing: 0.5px; margin-top: 2px;">a product by Noble Nexus</span>
            </div>
        </a>

        <!-- Auth Status (Hidden/Styled) -->
        <div id="auth-status" class="mb-4 small text-secondary" style="display:none;"></div>



        <div id="user-controls" class="flex-grow-1">
            <!-- Navigation Items Injected Here by Script.js -->
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">
        <!-- New Top Header for Desktop -->
        <div class="header-bar d-none d-md-flex">
            <div class="title-area">
                <h2 id="page-title">Dashboard</h2>
            </div>
            <div class="search-box">
                <span class="material-icons">search</span>
                <input type="text" placeholder="Search here...">
            </div>
            <div class="user-menu">
                <!-- Messages Dropdown -->
                <div class="dropdown">
                    <button class="notify-btn" data-bs-toggle="dropdown" aria-expanded="false">
                        <span class="material-icons">mail</span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end border-0 shadow-lg p-0" style="width: 320px;">
                        <div class="p-3 border-bottom bg-primary-subtle rounded-top">
                            <h6 class="mb-0 fw-bold text-primary">Messages</h6>
                        </div>
                        <div class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                            <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3"
                                onclick="switchView('communication-view')">
                                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center"
                                    style="width:40px; height:40px; flex-shrink:0;">
                                    <span class="material-icons text-secondary fs-5">person</span>
                                </div>
                                <div>
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <b class="small">Parent Association</b>
                                        <small class="text-muted" style="font-size: 10px;">10:30 AM</small>
                                    </div>
                                    <p class="mb-0 small text-muted text-truncate" style="max-width: 200px;">Re: Annual
                                        Science Fair Fund...</p>
                                </div>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action d-flex gap-3 py-3"
                                onclick="switchView('communication-view')">
                                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center"
                                    style="width:40px; height:40px; flex-shrink:0;">
                                    <span class="material-icons text-secondary fs-5">person</span>
                                </div>
                                <div>
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <b class="small">David Miller</b>
                                        <small class="text-muted" style="font-size: 10px;">Yesterday</small>
                                    </div>
                                    <p class="mb-0 small text-muted text-truncate" style="max-width: 200px;">Meeting
                                        request regarding...</p>
                                </div>
                            </a>
                        </div>
                        <div class="p-2 text-center border-top">
                            <a href="#" class="small fw-bold text-decoration-none"
                                onclick="switchView('communication-view')">View All Messages</a>
                        </div>
                    </div>
                </div>

                <!-- Student Selector (Top Header) -->
                <div id="top-header-student-selector" class="d-none align-items-center gap-2 me-3"
                    style="min-width: 300px;">
                    <!-- Injected by script.js -->
                </div>

                <!-- Notifications Dropdown -->
                <div class="dropdown">
                    <button class="notify-btn position-relative" data-bs-toggle="dropdown" aria-expanded="false">
                        <span class="material-icons">notifications</span>
                        <span
                            class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"
                            style="left: 75% !important; top: 10px !important;">
                            <span class="visually-hidden">New alerts</span>
                        </span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end border-0 shadow-lg p-0" style="width: 320px;">
                        <div class="p-3 border-bottom bg-warning bg-opacity-10 rounded-top">
                            <h6 class="mb-0 fw-bold text-dark">Notifications</h6>
                        </div>
                        <div class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                            <div class="list-group-item d-flex gap-3 py-3">
                                <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center text-primary"
                                    style="width:36px; height:36px; flex-shrink:0;">
                                    <span class="material-icons fs-6">campaign</span>
                                </div>
                                <div>
                                    <p class="mb-1 small fw-bold">System Maintenance</p>
                                    <p class="mb-0 small text-muted">Scheduled for tonight at 12 AM.</p>
                                    <small class="text-muted opacity-75" style="font-size: 10px;">2 hours ago</small>
                                </div>
                            </div>
                            <div class="list-group-item d-flex gap-3 py-3">
                                <div class="bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center text-success"
                                    style="width:36px; height:36px; flex-shrink:0;">
                                    <span class="material-icons fs-6">task_alt</span>
                                </div>
                                <div>
                                    <p class="mb-1 small fw-bold">Assignment Submitted</p>
                                    <p class="mb-0 small text-muted">Alice Smith submitted "Math HW".</p>
                                    <small class="text-muted opacity-75" style="font-size: 10px;">5 hours ago</small>
                                </div>
                            </div>
                        </div>
                        <div class="p-2 text-center border-top">
                            <a href="#" class="small fw-bold text-decoration-none text-muted">Mark all as read</a>
                        </div>
                    </div>
                </div>
                <!-- User Profile Dropdown -->
                <div class="dropdown">
                    <div class="user-profile d-flex align-items-center gap-3 ps-3 border-start" style="cursor: pointer;"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="info text-end">
                            <div id="header-user-name" class="fw-bold fs-6">Surjeet</div>
                            <div id="header-user-role" class="text-secondary small">Admin</div>
                        </div>
                        <img src="https://ui-avatars.com/api/?name=Surjeet&background=random" alt="User"
                            class="rounded-circle" width="48" height="48" id="header-user-img">
                    </div>
                    <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg p-2" style="width: 220px;">
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2 py-2 rounded mb-1" href="#"
                                onclick="openProfileView()">
                                <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center text-primary"
                                    style="width:32px; height:32px;">
                                    <span class="material-icons fs-6">person</span>
                                </div>
                                <span class="fw-medium">My Profile</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider my-1">
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center gap-2 py-2 rounded text-danger" href="#"
                                onclick="handleLogout()">
                                <div class="bg-danger bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center text-danger"
                                    style="width:32px; height:32px;">
                                    <span class="material-icons fs-6">logout</span>
                                </div>
                                <span class="fw-bold">Logout</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Mobile Header (Visible only on mobile & when logged in) -->
        <div class="mobile-header">
            <button class="btn btn-link text-dark p-0 me-3" onclick="toggleSidebar()">
                <span class="material-icons" style="font-size: 28px;">menu</span>
            </button>
            <div class="d-flex align-items-center">
                <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'" alt="Logo"
                    style="height: 40px; width: auto; margin-right: 10px; border-radius: 8px;">
                <div class="d-flex flex-column lh-1">
                    <h5 class="m-0 fw-bold text-primary-custom">Class Bridge</h5>
                    <span class="text-muted text-uppercase" style="font-size: 0.55rem; letter-spacing: 0.5px;">a product
                        by Noble Nexus</span>
                </div>
            </div>
        </div>

        <!-- Landing View (Full Website Style) -->
        <div id="landing-view" class="view active"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; overflow-y: auto;">
            <!-- Shader Background Container -->
            <div id="shader-background-container"
                style="position: fixed; top:0; left:0; width:100%; height:100%; z-index: -1;"></div>

            <!-- ClassDojo-Inspired Header -->
            <nav id="landing-navbar" class="navbar navbar-expand-lg position-fixed top-0 w-100 py-4 glass-navbar"
                style="background: transparent; z-index: 100;">
                <div class="container d-flex align-items-center justify-content-between">
                    <!-- Brand -->
                    <a class="navbar-brand d-flex align-items-center gap-3 text-white" href="#">
                        <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'"
                            alt="Logo"
                            style="width: 45px; height: 45px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2);">
                        <div class="d-flex flex-column lh-1">
                            <span class="fw-bold fs-4" style="font-family: 'Poppins', sans-serif;">Class Bridge</span>
                            <span class="opacity-75 text-uppercase fw-medium"
                                style="font-size: 0.6rem; letter-spacing: 1px;">a product by Noble Nexus</span>
                        </div>
                    </a>

                    <!-- Nav Links (Desktop) -->
                    <div class="d-none d-md-flex align-items-center gap-5">
                        <a href="#" onclick="switchView('teachers-landing-view')"
                            class="text-white text-decoration-none fw-medium">Teachers</a>
                        <a href="#" onclick="switchView('students-landing-view')"
                            class="text-white text-decoration-none fw-medium">Students</a>
                        <a href="#" onclick="switchView('schools-landing-view')"
                            class="text-white text-decoration-none fw-medium">Schools</a>
                        <a href="#" onclick="switchView('resources-landing-view')"
                            class="text-white text-decoration-none fw-medium">Resources</a>
                    </div>

                    <!-- Buttons -->
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-light rounded-pill px-4 fw-bold"
                            onclick="switchView('login-view')">
                            Log in
                        </button>
                        <button class="btn btn-primary rounded-pill px-4 fw-bold" onclick="switchView('register-view')"
                            style="background-color: #4D44B5; border: none;">
                            Sign up
                        </button>
                    </div>
                </div>
            </nav>

            <!-- ClassDojo-Inspired Hero Section -->
            <section
                class="d-flex flex-column align-items-center justify-content-center text-center px-3 position-relative"
                style="min-height: 90vh; background-color: transparent; padding-top: 140px; overflow: hidden;">

                <!-- Shader Background Container -->
                <div id="shader-background"
                    style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 0;"></div>

                <div class="position-relative" style="z-index: 1;">
                    <h1 class="display-3 fw-bold mb-4"
                        style="color: #fff; font-family: 'Poppins', sans-serif; line-height: 1.3; letter-spacing: 0.5px; text-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                        Where classrooms<br>become communities
                    </h1>

                    <p class="fs-5 mb-5 text-light fw-medium">
                        Loved by millions of students and parents. <span
                            style="text-decoration: underline; text-decoration-color: #4D44B5; text-decoration-thickness: 3px;">Free
                            for teachers, forever.</span>
                    </p>

                    <!-- Role Selection Container -->
                    <div class="d-flex flex-column align-items-center w-100">
                        <p class="fw-bold text-uppercase text-light mb-4" style="letter-spacing: 1px;">Get started as
                            a...</p>

                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 justify-content-center w-100 px-4"
                            style="max-width: 1400px;">

                            <!-- Teacher Card -->
                            <div class="col">
                                <div class="role-card p-4 rounded-4 cursor-pointer glass-card h-100"
                                    onclick="selectLoginRole('Teacher'); showLogin()" style="cursor: pointer;">
                                    <div class="d-flex flex-column align-items-center gap-3">
                                        <div class="icon-circle d-flex align-items-center justify-content-center rounded-circle mb-2"
                                            style="width: 80px; height: 80px;">
                                            <span class="material-icons" style="font-size: 40px;">favorite</span>
                                        </div>
                                        <h5 class="fw-bold m-0 text-center">Teacher</h5>
                                        <span class="material-icons opacity-50">arrow_forward</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Parent Card -->
                            <div class="col">
                                <div class="role-card p-4 rounded-4 cursor-pointer glass-card h-100"
                                    onclick="selectLoginRole('Parent'); showLogin()" style="cursor: pointer;">
                                    <div class="d-flex flex-column align-items-center gap-3">
                                        <div class="icon-circle d-flex align-items-center justify-content-center rounded-circle mb-2"
                                            style="width: 80px; height: 80px;">
                                            <span class="material-icons" style="font-size: 40px;">home</span>
                                        </div>
                                        <h5 class="fw-bold m-0 text-center">Parent</h5>
                                        <span class="material-icons opacity-50">arrow_forward</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Student Card -->
                            <div class="col">
                                <div class="role-card p-4 rounded-4 cursor-pointer glass-card h-100"
                                    onclick="selectLoginRole('Student'); showLogin()" style="cursor: pointer;">
                                    <div class="d-flex flex-column align-items-center gap-3">
                                        <div class="icon-circle d-flex align-items-center justify-content-center rounded-circle mb-2"
                                            style="width: 80px; height: 80px;">
                                            <span class="material-icons" style="font-size: 40px;">backpack</span>
                                        </div>
                                        <h5 class="fw-bold m-0 text-center">Student</h5>
                                        <span class="material-icons opacity-50">arrow_forward</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Others Card -->
                            <div class="col">
                                <div class="role-card p-4 rounded-4 cursor-pointer glass-card h-100"
                                    onclick="new bootstrap.Modal(document.getElementById('othersRoleModal')).show();"
                                    style="cursor: pointer;">
                                    <div class="d-flex flex-column align-items-center gap-3">
                                        <div class="icon-circle d-flex align-items-center justify-content-center rounded-circle mb-2"
                                            style="width: 80px; height: 80px;">
                                            <span class="material-icons" style="font-size: 40px;">more_horiz</span>
                                        </div>
                                        <h5 class="fw-bold m-0 text-center">Others</h5>
                                        <span class="material-icons opacity-50">arrow_forward</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Others Role Selection Modal -->
                <div class="modal fade" id="othersRoleModal" tabindex="-1" aria-hidden="true"
                    style="backdrop-filter: blur(5px);">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-0 shadow-lg"
                            style="background: rgba(40, 36, 93, 0.95); color: white; border-radius: 20px;">
                            <div class="modal-header border-0">
                                <h5 class="modal-title fw-bold">Select Role</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <div class="d-flex justify-content-center gap-3">
                                    <!-- Principal -->
                                    <div class="role-card p-4 rounded-4 cursor-pointer glass-card text-center"
                                        onclick="selectLoginRole('Principal'); showLogin(); bootstrap.Modal.getInstance(document.getElementById('othersRoleModal')).hide();"
                                        style="flex: 1; min-width: 140px; cursor: pointer; background: rgba(255,255,255,0.1);">
                                        <div class="d-flex flex-column align-items-center gap-3">
                                            <div class="icon-circle d-flex align-items-center justify-content-center rounded-circle mb-2"
                                                style="width: 60px; height: 60px; background: rgba(255,255,255,0.2);">
                                                <span class="material-icons"
                                                    style="font-size: 30px;">account_balance</span>
                                            </div>
                                            <h6 class="fw-bold m-0">Principal</h6>
                                        </div>
                                    </div>

                                    <!-- Super Admin -->
                                    <div class="role-card p-4 rounded-4 cursor-pointer glass-card text-center"
                                        onclick="selectLoginRole('Admin'); showLogin(); bootstrap.Modal.getInstance(document.getElementById('othersRoleModal')).hide();"
                                        style="flex: 1; min-width: 140px; cursor: pointer; background: rgba(255,255,255,0.1);">
                                        <div class="d-flex flex-column align-items-center gap-3">
                                            <div class="icon-circle d-flex align-items-center justify-content-center rounded-circle mb-2"
                                                style="width: 60px; height: 60px; background: rgba(255,255,255,0.2);">
                                                <span class="material-icons" style="font-size: 30px;">badge</span>
                                            </div>
                                            <h6 class="fw-bold m-0">Super Admin</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Features Section -->
            <section id="features-section" class="py-5" style="background-color: #fff;">
                <div class="container py-4">
                    <div class="text-center mb-5">
                        <small class="text-primary fw-bold text-uppercase ls-1">Why Noble Nexus?</small>
                        <h2 class="fw-bold mt-2">Everything you need to excel</h2>
                    </div>

                    <div class="row g-4 justify-content-center">
                        <!-- Card 1 -->
                        <div class="col-md-4">
                            <div class="p-4 rounded-4 h-100 text-center transition-hover border"
                                style="background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                                <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 text-primary rounded-circle mb-4"
                                    style="width: 80px; height: 80px;">
                                    <span class="material-icons fs-1">insights</span>
                                </div>
                                <h4 class="fw-bold text-dark">Smart Analytics</h4>
                                <p class="text-muted">Track academic performance trends with clear, AI-driven
                                    visualizations that help students improve faster.</p>
                            </div>
                        </div>
                        <!-- Card 2 -->
                        <div class="col-md-4">
                            <div class="p-4 rounded-4 h-100 text-center transition-hover border"
                                style="background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                                <div class="d-inline-flex align-items-center justify-content-center bg-danger bg-opacity-10 text-danger rounded-circle mb-4"
                                    style="width: 80px; height: 80px;">
                                    <span class="material-icons fs-1">videocam</span>
                                </div>
                                <h4 class="fw-bold text-dark">Live Classrooms</h4>
                                <p class="text-muted">Integrated video conferencing allows for seamless remote learning
                                    sessions directly from your dashboard.</p>
                            </div>
                        </div>
                        <!-- Card 3 -->
                        <div class="col-md-4">
                            <div class="p-4 rounded-4 h-100 text-center transition-hover border"
                                style="background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                                <div class="d-inline-flex align-items-center justify-content-center bg-success bg-opacity-10 text-success rounded-circle mb-4"
                                    style="width: 80px; height: 80px;">
                                    <span class="material-icons fs-1">auto_awesome</span>
                                </div>
                                <h4 class="fw-bold text-dark">AI Guidance</h4>
                                <p class="text-muted">Experience personalized learning paths and automated feedback
                                    designed for every student's unique journey.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Statistics Banner -->
            <section class="py-5 bg-light border-top">
                <div class="container">
                    <div class="row text-center">
                        <div class="col-md-4 mb-3 mb-md-0">
                            <h2 class="fw-bold text-primary display-5">10k+</h2>
                            <p class="text-muted fw-medium">Active Students</p>
                        </div>
                        <div class="col-md-4 mb-3 mb-md-0">
                            <h2 class="fw-bold text-primary display-5">98%</h2>
                            <p class="text-muted fw-medium">Engagement Rate</p>
                        </div>
                        <div class="col-md-4">
                            <h2 class="fw-bold text-primary display-5">24/7</h2>
                            <p class="text-muted fw-medium">AI Support</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <!-- Detailed Footer (ClassDojo Style) -->
            <footer class="pt-5 pb-4" style="background-color: #2e2a5b; color: #fff;">
                <div class="container position-relative">
                    <div class="row g-4 justify-content-between">
                        <!-- Left Column: Brand & Downloads -->
                        <div class="col-lg-3 col-md-12">
                            <div class="d-flex align-items-center gap-3 mb-4">
                                <img src="./static/class_bridge_logo.jpg"
                                    onerror="this.src='./static/noble_nexus_logo.png'" alt="Logo"
                                    style="width: 50px; height: 50px; border-radius: 12px;">
                                <div class="d-flex flex-column lh-1">
                                    <span class="fw-bold fs-4">Class Bridge</span>
                                    <span class="opacity-50 text-uppercase mt-1"
                                        style="font-size: 0.65rem; letter-spacing: 0.5px;">a product by Noble
                                        Nexus</span>
                                </div>
                            </div>

                            <!-- Language Dropdown Mock -->
                            <div class="dropdown mb-4">
                                <button
                                    class="btn btn-secondary dropdown-toggle border-0 d-flex align-items-center justify-content-between gap-2"
                                    type="button" style="background-color: rgba(255,255,255,0.1); min-width: 160px;">
                                    <span>English (US)</span>
                                </button>
                            </div>

                            <div class="d-flex gap-2 flex-wrap">
                                <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg"
                                    alt="App Store" style="height: 40px; cursor: pointer;">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg"
                                    alt="Google Play" style="height: 40px; cursor: pointer;">
                            </div>
                        </div>

                        <!-- Links Columns -->
                        <div class="col-6 col-lg-2">
                            <h6 class="fw-bold mb-3 opacity-75">Company</h6>
                            <ul class="list-unstyled d-flex flex-column gap-2 small">
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">About us</a></li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Press</a></li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Careers</a></li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Engineering</a>
                                </li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Accessibility</a>
                                </li>
                            </ul>
                        </div>

                        <div class="col-6 col-lg-2">
                            <h6 class="fw-bold mb-3 opacity-75">Resources</h6>
                            <ul class="list-unstyled d-flex flex-column gap-2 small">
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Big Ideas</a></li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Training</a></li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Resources</a>
                                </li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Remote
                                        Learning</a></li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Noble Nexus
                                        Plus</a></li>
                            </ul>
                        </div>

                        <div class="col-6 col-lg-2">
                            <h6 class="fw-bold mb-3 opacity-75">Support</h6>
                            <ul class="list-unstyled d-flex flex-column gap-2 small">
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Help Center</a>
                                </li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Contact</a></li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Privacy Center</a>
                                </li>
                                <li><a href="#" class="text-white text-decoration-none hover-opacity">Cookie
                                        Settings</a></li>
                            </ul>
                        </div>

                        <!-- Floating QR Card Col -->
                        <div class="col-lg-3 d-none d-lg-block text-end position-relative">
                            <div class="bg-white text-dark p-3 rounded-4 shadow-lg d-inline-block text-center"
                                style="width: 160px;">
                                <h6 class="fw-bold mb-2">Get the app</h6>
                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=ClassBridgeApp"
                                    alt="QR" class="img-fluid mb-1">
                            </div>
                        </div>
                    </div>

                    <div
                        class="border-top border-secondary border-opacity-25 mt-5 pt-4 d-flex flex-wrap justify-content-between align-items-center small text-white opacity-75">
                        <div class="d-flex align-items-center gap-3">
                            <span>&copy; 2026 Noble Nexus, Inc.</span>
                            <a href="#" class="text-white text-decoration-none">Terms</a>
                            <a href="#" class="text-white text-decoration-none">Privacy</a>
                        </div>
                        <div class="d-flex gap-3">
                            <span class="material-icons fs-5 cursor-pointer">facebook</span>
                            <span class="material-icons fs-5 cursor-pointer">share</span>
                            <span class="material-icons fs-5 cursor-pointer">photo_camera</span>
                        </div>
                    </div>
                </div>
            </footer>
        </div>


        <!-- Teachers Landing View (Separate Page) -->
        <div id="teachers-landing-view" class="view"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; overflow-y: auto; background-color: #f8f9fa;">

            <!-- Navbar for Teachers View -->
            <nav class="navbar navbar-expand-lg position-fixed top-0 w-100 py-3 glass-navbar"
                style="background: white; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05);">
                <div class="container d-flex align-items-center justify-content-between">
                    <a class="navbar-brand d-flex align-items-center gap-3 text-primary-custom" href="#"
                        onclick="switchView('landing-view')">
                        <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'"
                            alt="Logo"
                            style="width: 45px; height: 45px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1);">
                        <div class="d-flex flex-column lh-1">
                            <span class="fw-bold fs-4" style="font-family: 'Poppins', sans-serif;">Class Bridge</span>
                            <span class="text-muted text-uppercase fw-medium"
                                style="font-size: 0.55rem; letter-spacing: 0.5px;">a product by Noble Nexus</span>
                        </div>
                    </a>

                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary rounded-pill px-4 fw-bold"
                            onclick="switchView('landing-view')">
                            Back to Home
                        </button>
                        <button class="btn btn-primary rounded-pill px-4 fw-bold"
                            onclick="selectLoginRole('Teacher'); showLogin()"
                            style="background-color: #4D44B5; border: none;">
                            Teacher Login
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Teachers Content Container -->
            <div class="container" style="padding-top: 100px;">
                <!-- Content will be injected here via JS or hardcoded -->
                <!-- Teachers Specific Section Expanded -->
                <div class="container-fluid p-0">
                    <!-- Hero Section (Dark Theme) -->
                    <section id="teachers-hero" class="py-5 bg-dark position-relative text-white overflow-hidden"
                        style="background: linear-gradient(135deg, #1a1640 0%, #2e2a5b 100%); min-height: 80vh; display: flex; align-items: center;">

                        <div class="container position-relative z-2">
                            <div class="row align-items-center justify-content-center text-center">
                                <div class="col-lg-10">
                                    <span
                                        class="badge bg-white bg-opacity-10 rounded-pill px-3 py-2 mb-4 border border-white border-opacity-25">
                                        Based on a true school story
                                    </span>
                                    <h1 class="display-2 fw-bold mb-4" style="line-height: 1.1;">
                                        The AI-Powered Assistant <br>
                                        <span class="text-transparent bg-clip-text"
                                            style="background: linear-gradient(to right, #a29bfe, #74b9ff); -webkit-background-clip: text; background-clip: text;">
                                            You Always Wished For
                                        </span>
                                    </h1>
                                    <p class="lead opacity-75 mb-5 mx-auto" style="max-width: 700px;">
                                        Noble Nexus isn't just a dashboard. It's a co-pilot that grades
                                        papers, plans lessons, and identifies struggling students before
                                        they fall behind.
                                    </p>

                                    <div class="d-flex gap-3 justify-content-center">
                                        <button
                                            class="btn btn-primary-custom btn-lg rounded-pill px-5 py-3 fw-bold d-flex align-items-center gap-2 transform-hover"
                                            onclick="document.getElementById('ai-demo-section').scrollIntoView({behavior: 'smooth'})">
                                            <span class="material-icons">play_circle</span> Watch AI Demo
                                        </button>
                                        <button
                                            class="btn btn-outline-light btn-lg rounded-pill px-5 py-3 fw-bold transform-hover"
                                            onclick="selectLoginRole('Teacher'); showLogin()">
                                            Get Started
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Hero Image/Mockup -->
                            <div class="row mt-5 justify-content-center">
                                <div class="col-lg-10">
                                    <div
                                        class="rounded-5 overflow-hidden shadow-lg border border-white border-opacity-10 position-relative">
                                        <img src="https://ui-avatars.com/api/?name=Dashboard+Preview&background=random&size=800"
                                            class="w-100 d-none" alt="Dashboard Helper">
                                        <!-- Simple CSS Mockup if image fails -->
                                        <div class="bg-white p-2" style="height: 400px; position: relative;">
                                            <!-- Header -->
                                            <div class="d-flex align-items-center border-bottom pb-2 px-3 pt-2">
                                                <div class="d-flex gap-2 me-auto">
                                                    <div class="rounded-circle bg-danger"
                                                        style="width:10px;height:10px"></div>
                                                    <div class="rounded-circle bg-warning"
                                                        style="width:10px;height:10px"></div>
                                                    <div class="rounded-circle bg-success"
                                                        style="width:10px;height:10px"></div>
                                                </div>
                                                <div class="small fw-bold text-muted">Noble Nexus AI
                                                    Architect</div>
                                            </div>
                                            <!-- Canvas -->
                                            <div class="row h-100 m-0">
                                                <div class="col-3 border-end bg-light p-3">
                                                    <div
                                                        class="skeleton-line w-75 mb-3 bg-secondary opacity-25 rounded">
                                                    </div>
                                                    <div
                                                        class="skeleton-line w-50 mb-3 bg-secondary opacity-25 rounded">
                                                    </div>
                                                    <div
                                                        class="skeleton-line w-100 mb-3 bg-secondary opacity-25 rounded">
                                                    </div>
                                                    <div
                                                        class="skeleton-line w-25 mb-3 bg-secondary opacity-25 rounded">
                                                    </div>
                                                </div>
                                                <div
                                                    class="col-9 p-4 d-flex flex-column align-items-center justify-content-center text-dark">
                                                    <div class="text-center mb-3">
                                                        <span class="material-icons text-primary my-3"
                                                            style="font-size: 48px">auto_awesome</span>
                                                        <h4 class="fw-bold">Generating Lesson Plan...</h4>
                                                        <p class="text-muted">Analyzing curriculum standards
                                                            for Grade 9 History</p>
                                                    </div>
                                                    <div class="progress w-50" style="height: 8px;">
                                                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                                                            role="progressbar" style="width: 75%"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Features Grid -->
                    <section class="py-5" id="ai-demo-section">
                        <div class="container py-5">
                            <div class="text-center mb-5">
                                <small class="text-uppercase fw-bold text-primary ls-1">Features</small>
                                <h2 class="display-5 fw-bold mt-2">Built for the Modern Classroom</h2>
                            </div>

                            <div class="row g-4">
                                <!-- Card 1 -->
                                <div class="col-md-4">
                                    <div
                                        class="p-4 rounded-4 h-100 bg-white shadow-sm border transform-hover position-relative overflow-hidden">
                                        <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 text-primary rounded-circle mb-4"
                                            style="width: 60px; height: 60px;">
                                            <span class="material-icons">quiz</span>
                                        </div>
                                        <h4 class="fw-bold mb-3">Quiz Generator</h4>
                                        <p class="text-muted">Upload a PDF chapter, and our AI generates 20
                                            distinct questions with answer keys in seconds.</p>
                                        <a href="#" class="text-primary fw-bold text-decoration-none stretched-link">Try
                                            Generator &rarr;</a>
                                    </div>
                                </div>

                                <!-- Card 2 -->
                                <div class="col-md-4">
                                    <div
                                        class="p-4 rounded-4 h-100 bg-white shadow-sm border transform-hover position-relative overflow-hidden">
                                        <div class="d-inline-flex align-items-center justify-content-center bg-success bg-opacity-10 text-success rounded-circle mb-4"
                                            style="width: 60px; height: 60px;">
                                            <span class="material-icons">insights</span>
                                        </div>
                                        <h4 class="fw-bold mb-3">Student Insights</h4>
                                        <p class="text-muted">Beyond grades. See who is trying hard but
                                            struggling, and who needs more challenging material.</p>
                                        <a href="#"
                                            class="text-success fw-bold text-decoration-none stretched-link">View
                                            Sample Report &rarr;</a>
                                    </div>
                                </div>

                                <!-- Card 3 -->
                                <div class="col-md-4">
                                    <div
                                        class="p-4 rounded-4 h-100 bg-white shadow-sm border transform-hover position-relative overflow-hidden">
                                        <div class="d-inline-flex align-items-center justify-content-center bg-danger bg-opacity-10 text-danger rounded-circle mb-4"
                                            style="width: 60px; height: 60px;">
                                            <span class="material-icons">videocam</span>
                                        </div>
                                        <h4 class="fw-bold mb-3">Hybrid Classroom</h4>
                                        <p class="text-muted">Seamlessly switch between in-person and remote
                                            teaching with built-in video logic.</p>
                                        <a href="#" class="text-danger fw-bold text-decoration-none stretched-link">See
                                            How &rarr;</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Call to Action Footer within view -->
                    <section class="py-5 bg-light border-top">
                        <div class="container text-center py-5">
                            <h2 class="fw-bold mb-4">Ready to transform your teaching?</h2>
                            <button class="btn btn-primary-custom btn-lg rounded-pill px-5 shadow-lg"
                                onclick="selectLoginRole('Teacher'); showLogin()">
                                Join Noble Nexus for Free
                            </button>
                        </div>
                    </section>
                </div>
            </div>
        </div>


        <!-- Role & Permission Management View -->
        <div id="roles-view" class="view">
            <div class="row mb-4 align-items-center">
                <div class="col">
                    <h2 class="fw-bold mb-1">Access Control</h2>
                    <p class="text-muted mb-0">Manage roles and system permissions.</p>
                </div>
            </div>

            <!-- Tabs -->
            <ul class="nav nav-tabs mb-4" id="rbacTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active fw-bold" id="roles-tab" data-bs-toggle="tab"
                        data-bs-target="#roles-pane" type="button" role="tab" aria-selected="true">Roles</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link fw-bold" id="perms-tab" data-bs-toggle="tab" data-bs-target="#perms-pane"
                        type="button" role="tab" aria-selected="false"
                        onclick="loadPermissionsList()">Permissions</button>
                </li>
            </ul>

            <div class="tab-content" id="rbacTabContent">
                <!-- ROLES TAB -->
                <div class="tab-pane fade show active" id="roles-pane" role="tabpanel" aria-labelledby="roles-tab">
                    <div class="d-flex justify-content-end mb-3" id="role-create-action">
                        <!-- Create Button rendered via JS -->
                    </div>

                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="ps-4">Code</th>
                                            <th>Role Title</th>
                                            <th>Status</th>
                                            <th>Description</th>
                                            <th class="text-end pe-4">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="roles-table-body">
                                        <!-- Roles populated via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PERMISSIONS TAB -->
                <div class="tab-pane fade" id="perms-pane" role="tabpanel" aria-labelledby="perms-tab">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="ps-4">Permission Code</th>
                                            <th>Permission Title</th>
                                            <th>Description</th>
                                            <th class="text-end pe-4">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="perms-table-body">
                                        <!-- Perms populated via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROLE FORM VIEW -->
        <div id="role-form-view" class="view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-light rounded-circle shadow-sm" onclick="switchView('roles-view')">
                        <span class="material-icons text-dark">arrow_back</span>
                    </button>
                    <h1 class="h3 fw-bold text-dark mb-0" id="role-form-title">Create Role</h1>
                </div>
            </div>

            <div class="card border-0 shadow-sm rounded-4 p-4">
                <form id="role-form">
                    <input type="hidden" id="role-id">

                    <!-- Section 1: General Detail -->
                    <h6 class="fw-bold text-primary mb-3">1. General Details</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted text-uppercase">Role Title</label>
                            <input type="text" class="form-control bg-light border-0" id="role-name"
                                placeholder="e.g. Lab Assistant" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted text-uppercase">Status</label>
                            <div class="d-flex gap-3 mt-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="roleStatus" id="statusActive"
                                        value="Active" checked>
                                    <label class="form-check-label" for="statusActive">Active</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="roleStatus" id="statusInactive"
                                        value="Inactive">
                                    <label class="form-check-label" for="statusInactive">Inactive</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold text-muted text-uppercase">Description</label>
                            <textarea class="form-control bg-light border-0" id="role-desc" rows="2"
                                placeholder="Describe the role..."></textarea>
                        </div>
                    </div>

                    <!-- Section 2: Permission Association -->
                    <h6 class="fw-bold text-primary mb-3">2. Permission Association</h6>
                    <div class="bg-light rounded p-3 mb-4" style="max-height: 500px; overflow-y: auto;">
                        <div id="role-perms-container">
                            <!-- Perms populated via JS -->
                            <div class="text-center p-3">
                                <div class="spinner-border spinner-border-sm text-muted"></div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <button type="button" class="btn btn-light" onclick="switchView('roles-view')">Cancel</button>
                        <button type="button" class="btn btn-primary-custom px-4" onclick="handleSaveRole()">Save
                            Role</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Resources & Policy Library View -->
        <div id="resources-view" class="view">
            <div class="row mb-4 align-items-center">
                <div class="col">
                    <!-- Title handled by page-title in header -->
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary-custom d-none" id="btn-upload-resource"
                        onclick="openUploadResourceModal()">
                        <span class="material-icons align-middle fs-5 me-1">upload_file</span>
                        Upload Resource
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body py-3">
                    <div class="d-flex gap-3 align-items-center font-weight-bold">
                        <button class="btn btn-sm btn-outline-primary active rounded-pill px-3"
                            onclick="filterResources('All', this)">All</button>
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3"
                            onclick="filterResources('Policy', this)">Policies</button>
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3"
                            onclick="filterResources('Schedule', this)">Exam Schedules</button>
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3"
                            onclick="filterResources('Form', this)">Forms</button>
                        <button class="btn btn-sm btn-outline-primary rounded-pill px-3"
                            onclick="filterResources('Other', this)">Other</button>
                    </div>
                </div>
            </div>

            <!-- Resources List -->
            <div class="row g-4" id="resources-list-container">
                <!-- Injected via JS -->
                <div class="col-12 text-center py-5 text-muted">
                    <div class="spinner-border text-primary" role="status"></div>
                </div>
            </div>
        </div>

        <!-- UPLOAD RESOURCE VIEW (Converted from Modal) -->
        <div id="upload-resource-view" class="view">
            <div class="row mb-4 align-items-center">
                <div class="col-auto">
                    <button class="btn btn-light rounded-circle border shadow-sm"
                        onclick="switchView('resources-view')">
                        <span class="material-icons text-dark">arrow_back</span>
                    </button>
                </div>
                <div class="col">
                    <h2 class="fw-bold mb-1">Upload New Resource</h2>
                    <p class="text-muted mb-0">Add policies, schedules, or forms to the library.</p>
                </div>
            </div>

            <div class="card border-0 shadow-sm glass-card-solid" style="max-width: 800px; margin: 0 auto;">
                <div class="card-body p-5">
                    <form id="upload-resource-form-view" onsubmit="handleUploadResourceView(event)">
                        <div class="mb-4">
                            <label class="form-label small fw-bold text-muted text-uppercase">Title</label>
                            <input type="text" class="form-control bg-light border-0 p-3" id="res-title-view"
                                placeholder="e.g. Annual Exam Schedule 2026" required>
                        </div>
                        <div class="mb-4">
                            <label class="form-label small fw-bold text-muted text-uppercase">Category</label>
                            <select class="form-select bg-light border-0 p-3" id="res-category-view">
                                <option value="Policy">School Policy</option>
                                <option value="Schedule">Exam Schedule</option>
                                <option value="Form">Leave/Admin Form</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="form-label small fw-bold text-muted text-uppercase">Description</label>
                            <textarea class="form-control bg-light border-0 p-3" id="res-desc-view" rows="4"
                                placeholder="Brief description of the document..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="form-label small fw-bold text-muted text-uppercase">File (PDF, Doc,
                                Image)</label>
                            <div class="p-5 border-2 border-dashed rounded-3 text-center bg-light position-relative">
                                <span class="material-icons fs-1 text-muted mb-2">cloud_upload</span>
                                <p class="small text-muted mb-3">Drag & drop or click to upload</p>
                                <input type="file"
                                    class="form-control position-absolute top-0 start-0 w-100 h-100 opacity-0"
                                    id="res-file-view" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png" required
                                    style="cursor: pointer;"
                                    onchange="document.getElementById('file-name-display').textContent = this.files[0]?.name; document.getElementById('file-name-display').classList.remove('d-none');">
                                <div id="file-name-display" class="small fw-bold text-primary mt-2 d-none"></div>
                            </div>
                            <div class="form-text text-muted small mt-2">Max size 10MB. Supported: PDF, DOCX, TXT, JPG,
                                PNG</div>
                        </div>
                        <div class="d-flex justify-content-end gap-3 mt-5">
                            <button type="button" class="btn btn-light border px-4 rounded-pill"
                                onclick="switchView('resources-view')">Cancel</button>
                            <button type="submit"
                                class="btn btn-primary-custom px-5 rounded-pill fw-bold shadow-sm">Upload
                                Resource</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ADD USER VIEW (Converted from Modal) -->
        <div id="add-user-view" class="view">
            <div class="row mb-4 align-items-center">
                <div class="col-auto">
                    <button class="btn btn-light rounded-circle border shadow-sm" onclick="switchView('staff-view')">
                        <!-- Default back to staff/users -->
                        <span class="material-icons text-dark">arrow_back</span>
                    </button>
                </div>
                <div class="col">
                    <h2 class="fw-bold mb-1">Create New User</h2>
                    <p class="text-muted mb-0">Onboard a new student, teacher, or staff member.</p>
                </div>
            </div>

            <div class="card border-0 shadow-sm glass-card-solid" style="max-width: 800px; margin: 0 auto;">
                <div class="card-body p-5">
                    <form id="add-user-form-view" onsubmit="handleCreateUserView(event)">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" id="new-user-name-view" class="form-control bg-light border-0"
                                        placeholder="Full Name" required>
                                    <label>Full Name</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" id="new-user-id-view" class="form-control bg-light border-0"
                                        placeholder="Email or Unique ID" required>
                                    <label>Email or Unique ID</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select id="new-user-role-view" class="form-select bg-light border-0" required
                                        onchange="toggleUserFieldsView()">
                                        <option value="Student">Student</option>
                                        <option value="Teacher">Teacher</option>
                                        <option value="Parent_Guardian">Parent / Guardian</option>
                                        <option value="Tenant_Admin">Tenant Admin (Principal)</option>
                                        <option value="Academic_Admin">Academic Admin</option>
                                        <option value="Finance_Officer">Finance Officer</option>
                                        <option value="HR_Admin">HR Admin</option>
                                        <option value="Root_Super_Admin">Root Super Admin</option>
                                    </select>
                                    <label>Role</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="password" id="new-user-password-view"
                                        class="form-control bg-light border-0" placeholder="Password" required>
                                    <label>Password</label>
                                </div>
                                <small class="text-muted ms-1" style="font-size: 11px;">Min 8 chars, 1 number, 1 special
                                    char.</small>
                            </div>

                            <!-- Conditional Fields -->
                            <div class="col-12" id="student-fields-view">
                                <div class="form-floating">
                                    <select id="new-user-grade-view" class="form-select bg-light border-0">
                                        <option value="9">Grade 9</option>
                                        <option value="10">Grade 10</option>
                                        <option value="11">Grade 11</option>
                                        <option value="12">Grade 12</option>
                                    </select>
                                    <label>Grade</label>
                                </div>
                            </div>
                            <div class="col-12" id="teacher-fields-view" style="display:none;">
                                <div class="form-floating">
                                    <input type="text" id="new-user-subject-view" class="form-control bg-light border-0"
                                        placeholder="Science">
                                    <label>Preferred/Teaching Subject</label>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end gap-3 mt-5">
                            <button type="button" class="btn btn-light border px-4 rounded-pill"
                                onclick="switchView('staff-view')">Cancel</button>
                            <button type="submit"
                                class="btn btn-primary-custom px-5 rounded-pill fw-bold shadow-sm">Create User</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


        <!-- NEW VIEWS FOR SIDEBAR SUB-MENUS -->
        <!-- Create Class View -->
        <div id="create-class-view" class="view">
            <h2 class="fw-bold mb-4">Create New Class</h2>
            <div class="card p-4 border-0 shadow-sm">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Class Name</label>
                        <input type="text" class="form-control" placeholder="e.g. Mathematics 101">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Grade Level</label>
                        <select class="form-select">
                            <option>Grade 9</option>
                            <option>Grade 10</option>
                            <option>Grade 11</option>
                            <option>Grade 12</option>
                        </select>
                    </div>
                    <button type="button" class="btn btn-primary-custom" onclick="alert('Class Created!')">Create
                        Class</button>
                </form>
            </div>
        </div>

        <!-- Attendance Report View -->
        <div id="attendance-report-view" class="view">
            <h2 class="fw-bold mb-4">Attendance Report</h2>
            <div class="card p-4 border-0 shadow-sm">
                <p class="text-muted">Attendance analytics and reports will appear here.</p>
                <div class="d-flex gap-3">
                    <button class="btn btn-outline-primary">Download CSV</button>
                    <button class="btn btn-outline-info">Print Report</button>
                </div>
            </div>
        </div>

        <!-- Performance Report View -->
        <div id="performance-report-view" class="view">
            <h2 class="fw-bold mb-4">Performance Report</h2>
            <div class="card p-4 border-0 shadow-sm">
                <p class="text-muted">Detailed student performance metrics will appear here.</p>
            </div>
        </div>

        <!-- Upcoming Exams View -->
        <div id="upcoming-exams-view" class="view">
            <h2 class="fw-bold mb-4">Upcoming Exams</h2>
            <div class="card p-4 border-0 shadow-sm">
                <p class="text-muted">List of scheduled exams.</p>
            </div>
        </div>

        <!-- Upload Resource Modal (Legacy) -->
        <div class="modal fade" id="uploadResourceModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow">
                    <div class="modal-header border-bottom-0 pb-0">
                        <h5 class="modal-title fw-bold">Upload Resource</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body pt-4">
                        <form id="upload-resource-form">
                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted text-uppercase">Title</label>
                                <input type="text" class="form-control bg-light border-0" id="res-title" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted text-uppercase">Category</label>
                                <select class="form-select bg-light border-0" id="res-category">
                                    <option value="Policy">School Policy</option>
                                    <option value="Schedule">Exam Schedule</option>
                                    <option value="Form">Leave/Admin Form</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted text-uppercase">Description</label>
                                <textarea class="form-control bg-light border-0" id="res-desc" rows="2"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted text-uppercase">File (PDF,
                                    Doc)</label>
                                <input type="file" class="form-control bg-light border-0" id="res-file"
                                    accept=".pdf,.doc,.docx,.txt" required>
                                <div class="form-text text-muted small">Max size 5MB</div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer border-top-0 pt-0">
                        <button type="button" class="btn btn-light rounded-pill px-4 fw-bold"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary rounded-pill px-4 fw-bold shadow-sm"
                            onclick="handleUploadResource()">Upload</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Permission Edit Modal -->
        <div class="modal fade" id="permEditModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content border-0 shadow">
                    <div class="modal-header border-bottom-0 pb-0">
                        <h5 class="modal-title fw-bold">Edit Permission</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body pt-4">
                        <form id="perm-edit-form">
                            <input type="hidden" id="perm-edit-id">

                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted text-uppercase">Permission
                                    Code</label>
                                <input type="text" class="form-control bg-light" id="perm-edit-code" disabled>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted text-uppercase">Permission
                                    Title</label>
                                <input type="text" class="form-control bg-light" id="perm-edit-title" disabled>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted text-uppercase">Description</label>
                                <textarea class="form-control" id="perm-edit-desc" rows="3" required></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer border-top-0 pt-0">
                        <button type="button" class="btn btn-light rounded-pill px-4 fw-bold"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary rounded-pill px-4 fw-bold shadow-sm"
                            onclick="handleUpdatePermission()">Update</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Role Modal -->


        <div id="students-landing-view" class="view"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; overflow-y: auto; background-color: #f0f9ff;">

            <!-- Navbar for Students View -->
            <nav class="navbar navbar-expand-lg position-fixed top-0 w-100 py-3 glass-navbar"
                style="background: white; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05);">
                <div class="container d-flex align-items-center justify-content-between">
                    <a class="navbar-brand d-flex align-items-center gap-3 text-primary-custom" href="#"
                        onclick="switchView('landing-view')">
                        <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'"
                            alt="Logo"
                            style="width: 45px; height: 45px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1);">
                        <div class="d-flex flex-column lh-1">
                            <span class="fw-bold fs-4" style="font-family: 'Poppins', sans-serif;">Class Bridge</span>
                            <span class="text-muted text-uppercase fw-medium"
                                style="font-size: 0.55rem; letter-spacing: 0.5px;">a product by Noble Nexus</span>
                        </div>
                    </a>

                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary rounded-pill px-4 fw-bold"
                            onclick="switchView('landing-view')">
                            Back
                        </button>
                        <button class="btn btn-primary rounded-pill px-4 fw-bold"
                            onclick="selectLoginRole('Student'); showLogin()"
                            style="background-color: #0ea5e9; border: none;">
                            Student Login
                        </button>
                    </div>
                </div>
            </nav>

            <div class="container" style="padding-top: 100px;">
                <div class="container-fluid p-0">
                    <!-- Hero Section (Blue Theme) -->
                    <section id="students-hero"
                        class="py-5 position-relative text-white overflow-hidden rounded-5 shadow-lg mb-5"
                        style="background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); min-height: 75vh; display: flex; align-items: center;">

                        <div class="container position-relative z-2">
                            <div class="row align-items-center">
                                <div class="col-lg-6 text-start">
                                    <span
                                        class="badge bg-white bg-opacity-20 rounded-pill px-3 py-2 mb-4 border border-white border-opacity-25">
                                        For Students
                                    </span>
                                    <h1 class="display-3 fw-bold mb-4" style="line-height: 1.1;">
                                        Learning Just Got <br>
                                        <span class="text-warning">Superpowered.</span>
                                    </h1>
                                    <p class="lead opacity-90 mb-5">
                                        Stuck on homework? Need a practice quiz? Your AI tutor is here 24/7.
                                        Earn badges, track your growth, and crush your exams.
                                    </p>

                                    <div class="d-flex gap-3">
                                        <button
                                            class="btn btn-light fw-bold btn-lg rounded-pill px-5 py-3 shadow-lg transform-hover"
                                            onclick="selectLoginRole('Student'); showLogin()"
                                            style="color: #0284c7 !important;">
                                            Start Learning
                                        </button>
                                        <button
                                            class="btn btn-outline-light btn-lg rounded-pill px-5 py-3 fw-bold transform-hover"
                                            onclick="document.getElementById('student-features').scrollIntoView({behavior: 'smooth'})">
                                            Explore
                                        </button>
                                    </div>
                                </div>
                                <div class="col-lg-6 d-none d-lg-block position-relative">
                                    <!-- Mockup of Student UI -->
                                    <div class="bg-white p-3 rounded-4 shadow-lg text-dark transform-hover"
                                        style="transform: rotate(-2deg); max-width: 450px; margin-left: auto;">
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="bg-primary bg-opacity-10 p-2 rounded-circle me-3">
                                                <span class="material-icons text-primary">psychology_alt</span>
                                            </div>
                                            <div>
                                                <h6 class="fw-bold mb-0">AI Tutor</h6>
                                                <small class="text-muted">Just now</small>
                                            </div>
                                        </div>
                                        <div class="bg-light p-3 rounded-3 mb-3 small">
                                            "Great job on that algebra problem! You've mastered quadratic equations.
                                            Ready for a challenge?"
                                        </div>
                                        <div class="d-flex gap-2">
                                            <div
                                                class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 p-2 px-3 rounded-pill">
                                                +50 XP
                                            </div>
                                            <div
                                                class="badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25 p-2 px-3 rounded-pill">
                                                 Streak: 5 Days
                                            </div>
                                        </div>
                                    </div>

                                    <div class="bg-white p-3 rounded-4 shadow-lg text-dark transform-hover position-absolute top-100 start-0 translate-middle-y"
                                        style="transform: rotate(3deg); bottom: -40px; left: -50px; width: 300px; z-index: -1;">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="fw-bold small">Next Class: Physics</span>
                                            <span class="badge bg-danger rounded-pill">Live</span>
                                        </div>
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-danger w-75"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Features Grid -->
                    <section class="py-5 px-3" id="student-features">
                        <div class="container">
                            <div class="text-center mb-5">
                                <h2 class="display-6 fw-bold">Everything you need to ace it.</h2>
                            </div>

                            <div class="row g-4">
                                <!-- Feature 1 -->
                                <div class="col-md-4 fade-in-up delay-100">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-info">
                                                <span class="material-icons fs-1 anim-icon anim-icon-1">chat</span>
                                            </div>
                                            <h4 class="fw-bold">24/7 AI Help</h4>
                                            <p class="text-muted">Never get stuck again. Ask questions and get instant,
                                                step-by-step explanations.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Feature 2 -->
                                <div class="col-md-4 fade-in-up delay-200">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-warning">
                                                <span
                                                    class="material-icons fs-1 anim-icon anim-icon-2">emoji_events</span>
                                            </div>
                                            <h4 class="fw-bold">Gamified Growth</h4>
                                            <p class="text-muted">Earn XP, unlock badges, and climb the leaderboard as
                                                you
                                                complete assignments.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Feature 3 -->
                                <div class="col-md-4 fade-in-up delay-300">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-purple" style="color: #8b5cf6;">
                                                <span
                                                    class="material-icons fs-1 anim-icon anim-icon-3">auto_graph</span>
                                            </div>
                                            <h4 class="fw-bold">Smart Insights</h4>
                                            <p class="text-muted">Understand your strengths and weaknesses with
                                                personalized
                                                performance analytics.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>


        <!-- Schools Landing View (Separate Page) -->
        <div id="schools-landing-view" class="view"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; overflow-y: auto; background-color: #fafbfc;">

            <!-- Navbar for Schools View -->
            <nav class="navbar navbar-expand-lg position-fixed top-0 w-100 py-3 glass-navbar"
                style="background: white; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05);">
                <div class="container d-flex align-items-center justify-content-between">
                    <a class="navbar-brand d-flex align-items-center gap-3 text-primary-custom" href="#"
                        onclick="switchView('landing-view')">
                        <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'"
                            alt="Logo"
                            style="width: 45px; height: 45px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1);">
                        <div class="d-flex flex-column lh-1">
                            <span class="fw-bold fs-4" style="font-family: 'Poppins', sans-serif;">Class Bridge</span>
                            <span class="text-muted text-uppercase fw-medium"
                                style="font-size: 0.55rem; letter-spacing: 0.5px;">a product by Noble Nexus</span>
                        </div>
                    </a>

                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary rounded-pill px-4 fw-bold"
                            onclick="switchView('landing-view')">
                            Back
                        </button>
                        <button class="btn btn-primary rounded-pill px-4 fw-bold"
                            onclick="selectLoginRole('Teacher'); showLogin()"
                            style="background-color: #4D44B5; border: none;">
                            Admin Login
                        </button>
                    </div>
                </div>
            </nav>

            <div class="container" style="padding-top: 100px;">
                <div class="container-fluid p-0">
                    <!-- Hero Section (Purple/Admin Theme) -->
                    <section id="schools-hero"
                        class="py-5 position-relative text-white overflow-hidden rounded-5 shadow-lg mb-5"
                        style="background: linear-gradient(135deg, #4D44B5 0%, #3a32a0 100%); min-height: 75vh; display: flex; align-items: center;">

                        <!-- Background Animation Target -->

                        <div class="container position-relative z-2">
                            <div class="row align-items-center">
                                <div class="col-lg-6 text-start">
                                    <span
                                        class="badge bg-white bg-opacity-20 rounded-pill px-3 py-2 mb-4 border border-white border-opacity-25">
                                        For Schools & Districts
                                    </span>
                                    <h1 class="display-3 fw-bold mb-4" style="line-height: 1.1;">
                                        Manage Your Empire <br>
                                        <span class="text-warning">Effortlessly.</span>
                                    </h1>
                                    <p class="lead opacity-90 mb-5">
                                        From attendance to analytics, empower your entire institution with a unified
                                        ecosystem that principals and admins love.
                                    </p>

                                    <div class="d-flex gap-3">
                                        <button
                                            class="btn btn-light text-primary-custom fw-bold btn-lg rounded-pill px-5 py-3 shadow-lg transform-hover"
                                            onclick="selectLoginRole('Admin'); showLogin()">
                                            Get Started
                                        </button>
                                        <button
                                            class="btn btn-outline-light btn-lg rounded-pill px-5 py-3 fw-bold transform-hover"
                                            onclick="document.getElementById('school-features').scrollIntoView({behavior: 'smooth'})">
                                            See Features
                                        </button>
                                    </div>
                                </div>
                                <div class="col-lg-6 d-none d-lg-block position-relative">
                                    <!-- Mockup of Dashboard -->
                                    <div class="bg-white p-2 rounded-4 shadow-lg text-dark transform-hover"
                                        style="transform: rotate(1deg); max-width: 500px; margin-left: auto;">
                                        <div class="bg-light p-3 rounded-3 mb-2 d-flex justify-content-between">
                                            <strong>Total Students</strong>
                                            <span class="text-primary fw-bold">12,450</span>
                                        </div>
                                        <div class="bg-light p-3 rounded-3 mb-2 d-flex justify-content-between">
                                            <strong>Teacher Retention</strong>
                                            <span class="text-success fw-bold">98%</span>
                                        </div>
                                        <div class="bg-light p-3 rounded-3 d-flex justify-content-between">
                                            <strong>Avg Grade</strong>
                                            <span class="text-warning fw-bold">A-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Features Grid -->
                    <section class="py-5 px-3" id="school-features">
                        <div class="container">
                            <div class="text-center mb-5">
                                <h2 class="display-6 fw-bold">Enterprise-Grade Control.</h2>
                            </div>

                            <div class="row g-4">
                                <!-- Feature 1 -->
                                <div class="col-md-4">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-primary">
                                                <span class="material-icons fs-1">dashboard</span>
                                            </div>
                                            <h4 class="fw-bold">Unified Dashboard</h4>
                                            <p class="text-muted">Monitor attendance, grades, and behavior across all
                                                classrooms in real-time.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Feature 2 -->
                                <div class="col-md-4">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-success">
                                                <span class="material-icons fs-1">analytics</span>
                                            </div>
                                            <h4 class="fw-bold">Smart Analytics</h4>
                                            <p class="text-muted">Data-driven insights to identify at-risk students and
                                                improve curriculum effectiveness.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Feature 3 -->
                                <div class="col-md-4">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-info">
                                                <span class="material-icons fs-1">security</span>
                                            </div>
                                            <h4 class="fw-bold">Secure & Scalable</h4>
                                            <p class="text-muted">Bank-level encryption and privacy complaince derived
                                                from the ground up.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>


        <!-- Resources Landing View (Separate Page) -->
        <div id="resources-landing-view" class="view"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; overflow-y: auto; background-color: #f0fdf4;">

            <!-- Navbar for Resources View -->
            <nav class="navbar navbar-expand-lg position-fixed top-0 w-100 py-3 glass-navbar"
                style="background: white; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05);">
                <div class="container d-flex align-items-center justify-content-between">
                    <a class="navbar-brand d-flex align-items-center gap-3 text-primary-custom" href="#"
                        onclick="switchView('landing-view')">
                        <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'"
                            alt="Logo"
                            style="width: 45px; height: 45px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1);">
                        <div class="d-flex flex-column lh-1">
                            <span class="fw-bold fs-4" style="font-family: 'Poppins', sans-serif;">Class Bridge</span>
                            <span class="text-muted text-uppercase fw-medium"
                                style="font-size: 0.55rem; letter-spacing: 0.5px;">a product by Noble Nexus</span>
                        </div>
                    </a>

                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary rounded-pill px-4 fw-bold"
                            onclick="switchView('landing-view')">
                            Back
                        </button>
                        <button class="btn btn-primary rounded-pill px-4 fw-bold"
                            onclick="selectLoginRole('Teacher'); showLogin()"
                            style="background-color: #059669; border: none;">
                            Teacher Access
                        </button>
                    </div>
                </div>
            </nav>

            <div class="container" style="padding-top: 100px;">
                <div class="container-fluid p-0">
                    <!-- Hero Section (Green/Resources Theme) -->
                    <section id="resources-hero"
                        class="py-5 position-relative text-white overflow-hidden rounded-5 shadow-lg mb-5"
                        style="background: linear-gradient(135deg, #059669 0%, #047857 100%); min-height: 75vh; display: flex; align-items: center;">

                        <!-- Background Animation Target -->

                        <div class="container position-relative z-2">
                            <div class="row align-items-center">
                                <div class="col-lg-6 text-start">
                                    <span
                                        class="badge bg-white bg-opacity-20 rounded-pill px-3 py-2 mb-4 border border-white border-opacity-25">
                                        Content Library
                                    </span>
                                    <h1 class="display-3 fw-bold mb-4" style="line-height: 1.1;">
                                        World-Class Content. <br>
                                        <span class="text-warning">Zero Friction.</span>
                                    </h1>
                                    <p class="lead opacity-90 mb-5">
                                        Stop reinventing the wheel. Access thousands of vetted lesson plans,
                                        interactive quizzes, and multimedia assets instantly.
                                    </p>

                                    <div class="d-flex gap-3">
                                        <button
                                            class="btn btn-light text-success fw-bold btn-lg rounded-pill px-5 py-3 shadow-lg transform-hover"
                                            onclick="selectLoginRole('Teacher'); showLogin()">
                                            Browse Library
                                        </button>
                                        <button
                                            class="btn btn-outline-light btn-lg rounded-pill px-5 py-3 fw-bold transform-hover"
                                            onclick="document.getElementById('resource-features').scrollIntoView({behavior: 'smooth'})">
                                            Learn More
                                        </button>
                                    </div>
                                </div>
                                <div class="col-lg-6 d-none d-lg-block position-relative">
                                    <!-- Mockup of Content Card -->
                                    <div class="bg-white p-3 rounded-4 shadow-lg text-dark transform-hover"
                                        style="transform: rotate(2deg); max-width: 450px; margin-left: auto;">
                                        <!-- Fake Video Player -->
                                        <div class="bg-dark rounded-3 mb-3 position-relative d-flex align-items-center justify-content-center"
                                            style="height: 200px; background: #e5e7eb;">
                                            <span
                                                class="material-icons text-white display-1 opacity-75">play_circle_filled</span>
                                            <div
                                                class="position-absolute bottom-0 start-0 p-3 text-white w-100 bg-gradient-to-t from-black to-transparent">
                                                <small>Science  Grade 10</small>
                                                <h6 class="mb-0">Understanding Photosynthesis</h6>
                                            </div>
                                        </div>
                                        <div class="d-flex gap-2 mb-2">
                                            <span class="badge bg-light text-dark border">PDF Worksheet</span>
                                            <span class="badge bg-light text-dark border">Quiz Key</span>
                                        </div>
                                        <div class="d-flex align-items-center justify-content-between mt-3">
                                            <div class="d-flex align-items-center gap-2">
                                                <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center"
                                                    style="width:32px; height:32px;">SJ</div>
                                                <small class="fw-bold">Sarah J.</small>
                                            </div>
                                            <small class="text-muted">Downloaded 1.2k times</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Features Grid -->
                    <section class="py-5 px-3" id="resource-features">
                        <div class="container">
                            <div class="text-center mb-5">
                                <h2 class="display-6 fw-bold">Fuel for your teaching.</h2>
                            </div>

                            <div class="row g-4">
                                <!-- Feature 1 -->
                                <div class="col-md-4">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-success">
                                                <span class="material-icons fs-1">menu_book</span>
                                            </div>
                                            <h4 class="fw-bold">Lesson Plans</h4>
                                            <p class="text-muted">Standard-aligned curriculums ready to drop into your
                                                schedule today.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Feature 2 -->
                                <div class="col-md-4">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-danger">
                                                <span class="material-icons fs-1">smart_display</span>
                                            </div>
                                            <h4 class="fw-bold">Multimedia</h4>
                                            <p class="text-muted">High-quality videos and interactive simulations that
                                                make concepts stick.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Feature 3 -->
                                <div class="col-md-4">
                                    <div class="glowing-card">
                                        <div class="glowing-card-border"></div>
                                        <div class="glowing-card-content transform-hover">
                                            <div class="mb-3 text-primary">
                                                <span class="material-icons fs-1">group_work</span>
                                            </div>
                                            <h4 class="fw-bold">Community</h4>
                                            <p class="text-muted">Share, remix, and collaborate on resources with
                                                educators worldwide.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Login View (Split Website Style) -->
        <div id="login-view" class="view"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: #fff; overflow-y: auto;">
            <div class="row g-0 min-vh-100">
                <!-- Left Side: Branding & Welcome -->
                <div class="col-lg-6 d-none d-lg-flex position-relative text-white flex-column justify-content-center px-5 py-5"
                    style="overflow: hidden; background-image: url('https://hoirqrkdgbmvpwutwuwj.supabase.co/storage/v1/object/public/assets/assets/0e2dbea0-c0a9-413f-a57b-af279633c0df_3840w.jpg'); background-size: cover; background-position: center;">

                    <!-- Overlay to darken background for text readability -->
                    <div class="position-absolute top-0 start-0 w-100 h-100 bg-black opacity-50" style="z-index: 1;">
                    </div>

                    <!-- Navbar (Absolute) -->
                    <div class="position-absolute top-0 start-0 p-5" style="z-index: 2;">
                        <a href="#" class="d-flex align-items-center gap-3 text-white text-decoration-none"
                            onclick="switchView('landing-view')">
                            <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'"
                                alt="Logo"
                                style="width: 40px; height: 40px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.2);">
                            <div class="d-flex flex-column lh-1">
                                <span class="fw-bold fs-5">Class Bridge</span>
                                <span class="opacity-75 text-uppercase"
                                    style="font-size: 0.55rem; letter-spacing: 0.5px;">a product by Noble Nexus</span>
                            </div>
                        </a>
                    </div>

                    <div class="position-relative z-2" style="max-width: 500px; margin: 0 auto; z-index: 2;">
                        <span
                            class="bg-white text-primary px-3 py-1 rounded-pill small fw-bold text-uppercase mb-3 d-inline-block shadow-sm animate-fade-slide-in-1">
                            Student Portal
                        </span>
                        <h1 class="display-4 fw-bold mb-3 animate-fade-slide-in-2">Your Learning Journey Continues</h1>
                        <p class="lead opacity-90 animate-fade-slide-in-3">Log in to access your courses, live classes,
                            and personalized AI
                            insights.</p>

                        <!-- Stats -->
                        <div
                            class="row mt-5 pt-4 border-top border-white border-opacity-25 text-center animate-fade-slide-in-4">
                            <div class="col-4">
                                <h3 class="fw-bold mb-0">10k+</h3>
                                <small class="opacity-75">Students</small>
                            </div>
                            <div class="col-4 border-start border-end border-white border-opacity-25">
                                <h3 class="fw-bold mb-0">98%</h3>
                                <small class="opacity-75">Pass Rate</small>
                            </div>
                            <div class="col-4">
                                <h3 class="fw-bold mb-0">24/7</h3>
                                <small class="opacity-75">Access</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Login Form -->
                <div class="col-lg-6 d-flex flex-column bg-white position-relative">
                    <!-- Language & Mobile Nav -->
                    <div class="d-flex justify-content-between p-4 align-items-center mb-auto">
                        <a href="#"
                            class="d-lg-none d-flex align-items-center gap-2 text-primary-custom text-decoration-none"
                            onclick="switchView('landing-view')">
                            <span class="material-icons">arrow_back</span> Back
                        </a>
                        <div class="ms-auto" style="width: 140px;">
                            <select class="form-select form-select-sm" id="lang-toggle"
                                onchange="changeLanguage(this.value)" aria-label="Select Language">
                                <option value="en"> English</option>
                                <option value="es"> Espaol</option>
                            </select>
                        </div>
                    </div>

                    <div class="px-4 py-3 mx-auto w-100" style="max-width: 480px; margin-bottom: auto;">
                        <div class="text-center mb-4">
                            <div class="d-lg-none d-flex flex-column align-items-center mb-4">
                                <img src="./static/class_bridge_logo.jpg"
                                    onerror="this.src='./static/noble_nexus_logo.png'" alt="Logo"
                                    style="width: 60px; height: 60px; border-radius: 12px; margin-bottom: 0.5rem;">
                                <h5 class="fw-bold m-0 text-dark">Class Bridge</h5>
                                <small class="text-muted text-uppercase" style="font-size: 0.6rem;">a product by Noble
                                    Nexus</small>
                            </div>
                            <!-- Role Switcher -->
                            <!-- Role Selection Indicator -->
                            <div class="mb-4 text-center">
                                <div id="login-role-icon-container"
                                    class="d-inline-flex align-items-center justify-content-center rounded-circle mb-3"
                                    style="width: 70px; height: 70px; background-color: #F3F4FF; color: #4D44B5; transition: all 0.3s;">
                                    <span id="login-role-icon" class="material-icons"
                                        style="font-size: 36px;">school</span>
                                </div>
                                <div class="d-flex align-items-center justify-content-center gap-2 mt-2">
                                    <span class="text-muted small">Not a <span
                                            id="login-role-label">Student</span>?</span>
                                    <a href="#" onclick="switchView('landing-view')"
                                        class="text-primary-custom fw-bold small text-decoration-none bg-light px-3 py-1 rounded-pill border">Switch
                                        Role</a>
                                </div>
                            </div>

                            <h2 class="fw-bold text-dark mb-2" id="login-title">Student Login</h2>
                            <p class="text-muted" data-i18n="login_subtitle">Sign in to your account</p>
                        </div>

                        <form id="login-form">
                            <input type="hidden" id="selected-role" value="Student">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control bg-light border-0" id="username"
                                    placeholder="Username" required aria-label="Username or Student ID">
                                <label for="username" data-i18n="label_username">Username / Student ID</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="password" class="form-control bg-light border-0" id="password"
                                    placeholder="Password" required aria-label="Password">
                                <label for="password" data-i18n="label_password">Password</label>
                            </div>
                            <div class="text-end mb-4">
                                <a href="#" class="text-decoration-none small fw-medium text-primary-custom"
                                    data-bs-toggle="modal" data-bs-target="#forgotPasswordModal"
                                    data-i18n="link_forgot_password">Forgot Password?</a>
                            </div>

                            <p id="login-message" class="text-danger fw-medium min-h-20 mb-3 text-center"
                                aria-live="polite"></p>

                            <div class="d-flex gap-2 mb-4">
                                <button type="submit"
                                    class="pulse-connect-btn flex-grow-1 py-1 fw-bold rounded-pill shadow-lg"
                                    data-i18n="btn_signin">
                                    <div
                                        class="inner-ring d-flex align-items-center justify-content-center w-100 h-100 rounded-pill">
                                        <span class="gradient-text fs-5">Sign In</span>
                                    </div>
                                    <span class="absolute-shine"></span>
                                </button>
                                <button type="button"
                                    class="btn btn-outline-dark flex-grow-1 py-3 fw-bold rounded-pill shadow-sm"
                                    onclick="showRegister(event)">Sign Up</button>
                            </div>

                            <div class="d-flex align-items-center mb-4">
                                <hr class="flex-grow-1 bg-secondary opacity-25">
                                <span class="mx-3 text-muted small fw-medium text-uppercase"
                                    data-i18n="text_or">OR</span>
                                <hr class="flex-grow-1 bg-secondary opacity-25">
                            </div>

                            <!-- Social Buttons -->
                            <div class="row g-2">
                                <div class="col-12">
                                    <!-- FR-2: Real Google Button Container -->
                                    <div id="g_id_onload"
                                        data-client_id="275674033514-q7ghs0kt970m9soo44cqfusaqkkvgmb4.apps.googleusercontent.com"
                                        data-context="signin" data-ux_mode="popup"
                                        data-callback="handleCredentialResponse" data-auto_prompt="false">
                                    </div>

                                    <div class="g_id_signin w-100" data-type="standard" data-shape="rectangular"
                                        data-theme="outline" data-text="sign_in_with" data-size="large"
                                        data-logo_alignment="left">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button type="button"
                                        class="btn btn-outline-dark w-100 d-flex align-items-center justify-content-center gap-2 py-2"
                                        onclick="handleSocialLogin('Microsoft')">
                                        <img src="https://cdn-icons-png.flaticon.com/512/732/732221.png" width="20"
                                            height="20" alt="Microsoft Logo">
                                        <span data-i18n="btn_signin_microsoft">Sign in with Microsoft</span>
                                    </button>
                                </div>
                            </div>
                        </form>

                        <div class="mt-5 text-center small text-muted">
                            <p class="mb-1"><span data-i18n="text_new_user">New User?</span> <a href="#"
                                    onclick="showRegister(event)" class="text-primary-custom fw-bold ms-1"
                                    data-i18n="link_signup">Sign Up</a></p>
                            <a href="#" class="text-secondary text-decoration-none" data-i18n="link_help">Need help?
                                Contact support</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2FA View -->
        <!-- 2FA View (Split Layout) -->
        <div id="two-factor-view" class="view"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: #fff; overflow-y: auto;">
            <div class="row g-0 h-100">
                <!-- Left Side: Testimonial Cards Animation -->
                <div class="col-lg-6 d-none d-lg-flex position-relative align-items-center justify-content-center"
                    style="background-color: #0f172a; overflow: hidden;">
                    <div id="testimonial-cards-container" style="width: 100%; height: 100%;"></div>

                    <!-- Optional Branding overlay -->
                    <div class="position-absolute bottom-0 start-0 p-5 text-white" style="pointer-events: none;">
                        <h3 class="fw-bold">Join the Community</h3>
                        <p class="opacity-75">See what others are saying about Noble Nexus.</p>
                    </div>
                </div>

                <!-- Right Side: 2FA Form -->
                <div class="col-lg-6 d-flex align-items-center justify-content-center bg-light">
                    <div class="card shadow-lg border-0 rounded-4"
                        style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); max-width: 420px; width: 100%;">
                        <div class="card-body p-5 text-center">
                            <div class="mb-3">
                                <span class="material-icons text-primary-custom" style="font-size: 48px;">lock</span>
                            </div>
                            <h2 class="fw-bold mb-2">Two-Step Verification</h2>
                            <p class="text-muted mb-4">Enter your pre-generated lifetime code to continue.</p>

                            <form id="two-factor-form">
                                <div class="form-floating mb-3 text-start">
                                    <input type="text" class="form-control" id="2fa-code" placeholder="6-digit code"
                                        required autocomplete="off">
                                    <label for="2fa-code">Pre-generated Lifetime Code</label>
                                </div>

                                <p id="2fa-message" class="text-danger fw-medium min-h-20"></p>

                                <button type="submit"
                                    class="btn btn-primary-custom w-100 py-3 fw-bold rounded-3 mb-3">Verify</button>
                            </form>

                            <div id="demo-codes-container" class="alert alert-info small text-start d-none">
                                <strong>Demo Code Hint:</strong><br>
                                <span id="demo-codes-text"></span>
                            </div>

                            <div class="mt-2 text-muted small">
                                <a href="#" onclick="window.location.reload()" class="text-primary-custom fw-bold">Back
                                    to
                                    Login</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registration View (Split Website Style) -->
        <div id="register-view" class="view"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: #fff; overflow-y: auto;">
            <div class="row g-0 h-100">
                <!-- Left Side: Branding -->
                <div class="col-lg-6 d-none d-lg-flex position-relative text-white flex-column justify-content-center px-5 py-5"
                    style="background: linear-gradient(135deg, #4D44B5 0%, #764ba2 100%);">

                    <!-- Navbar (Absolute) -->
                    <div class="position-absolute top-0 start-0 p-5">
                        <a href="#" class="d-flex align-items-center gap-3 text-white text-decoration-none"
                            onclick="switchView('landing-view')">
                            <img src="./static/class_bridge_logo.jpg" onerror="this.src='./static/noble_nexus_logo.png'"
                                alt="Logo"
                                style="width: 40px; height: 40px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.2);">
                            <div class="d-flex flex-column lh-1">
                                <span class="fw-bold fs-5">Class Bridge</span>
                                <span class="opacity-75 text-uppercase"
                                    style="font-size: 0.55rem; letter-spacing: 0.5px;">a product by Noble Nexus</span>
                            </div>
                        </a>
                    </div>

                    <div class="position-relative z-2" style="max-width: 500px; margin: 0 auto;">
                        <span
                            class="bg-white text-primary px-3 py-1 rounded-pill small fw-bold text-uppercase mb-3 d-inline-block shadow-sm">
                            Join Noble Nexus
                        </span>
                        <h1 class="display-4 fw-bold mb-3">Begin Your Excellence Journey</h1>
                        <p class="lead opacity-90 mb-5">Create an account to unlock advanced AI learning tools, track
                            your progress, and join live classrooms.</p>

                        <div class="d-flex gap-4">
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-white rounded-circle d-flex align-items-center justify-content-center shadow-sm"
                                    style="width: 50px; height: 50px;">
                                    <span class="material-icons text-primary fs-4">school</span>
                                </div>
                                <div class="text-start">
                                    <h6 class="fw-bold mb-0">For Students</h6>
                                    <small class="opacity-75">Personalized AI Plans</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-white rounded-circle d-flex align-items-center justify-content-center shadow-sm"
                                    style="width: 50px; height: 50px;">
                                    <span class="material-icons text-danger fs-4">family_restroom</span>
                                </div>
                                <div class="text-start">
                                    <h6 class="fw-bold mb-0">For Parents</h6>
                                    <small class="opacity-75">Track Progress</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Decoration -->
                    <div class="position-absolute bottom-0 start-0 w-100 overflow-hidden" style="line-height: 0;">
                        <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"
                            preserveAspectRatio="none"
                            style="display: block; width: calc(100% + 1.3px); height: 80px; fill: #FFFFFF; transform: rotate(180deg);">
                            <path
                                d="M985.66,92.83C906.67,72,823.78,31,743.84,14.19c-82.26-17.34-168.06-16.33-250.45.39-57.84,11.73-114,31.07-172,41.86A600.21,600.21,0,0,1,0,27.35V120H1200V95.8C1132.19,118.92,1055.71,111.31,985.66,92.83Z">
                            </path>
                        </svg>
                    </div>
                </div>

                <!-- Right Side: Registration Form -->
                <div class="col-lg-6 d-flex flex-column bg-white h-100 position-relative">
                    <!-- Mobile Nav -->
                    <div class="d-flex justify-content-between p-4 align-items-center mb-auto">
                        <a href="#"
                            class="d-lg-none d-flex align-items-center gap-2 text-primary-custom text-decoration-none"
                            onclick="switchView('landing-view')">
                            <span class="material-icons">arrow_back</span> Back
                        </a>
                    </div>

                    <div class="px-4 py-3 mx-auto w-100" style="max-width: 480px; margin-bottom: auto;">
                        <div class="text-center mb-4">
                            <div class="d-inline-flex bg-primary bg-opacity-10 text-primary rounded-circle p-3 mb-3">
                                <span class="material-icons fs-2">person_add</span>
                            </div>
                            <h2 class="fw-bold text-dark mb-2">Create Account</h2>
                            <p class="text-muted">Join Noble Nexus Today</p>
                        </div>

                        <form id="register-form">
                            <!-- Name Field -->
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control bg-light border-0" id="reg-name"
                                    placeholder="Full Name" required>
                                <label for="reg-name">Full Name</label>
                            </div>

                            <!-- FR-Multi-School: School Selection -->
                            <div class="form-floating mb-3">
                                <select class="form-select bg-light border-0" id="reg-school" required>
                                    <option value="1">Independent / Default School</option>
                                </select>
                                <label for="reg-school">Select School</label>
                            </div>

                            <!-- FR-3: Role Selection -->
                            <div class="form-floating mb-3">
                                <select class="form-select bg-light border-0" id="reg-role" required
                                    onchange="handleRoleChange()">
                                    <option value="Student" selected>Student</option>
                                    <option value="Parent">Parent</option>
                                    <option value="Teacher">Teacher (Invite Only)</option>
                                </select>
                                <label for="reg-role">I am a...</label>
                            </div>

                            <!-- FR-4: Invitation Code -->
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control bg-light border-0" id="reg-invite"
                                    placeholder="Invitation Code (Optional)">
                                <label for="reg-invite">Invitation Code (Optional)</label>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="text" class="form-control bg-light border-0" id="reg-email"
                                    placeholder="Email / ID" required>
                                <label for="reg-email">Email / Student ID</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="password" class="form-control bg-light border-0" id="reg-password"
                                    placeholder="Password" required oninput="checkPasswordStrength(this.value)">
                                <label for="reg-password">Password</label>
                            </div>
                            <div id="password-strength-msg" class="small mb-3 ms-1 fw-bold text-muted"></div>

                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <div class="form-floating">
                                        <input type="number" class="form-control bg-light border-0" id="reg-grade"
                                            placeholder="Grade" min="1" max="12" value="9" required>
                                        <label for="reg-grade">Grade</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-floating">
                                        <select class="form-select bg-light border-0" id="reg-subject" required>
                                            <option value="General">General</option>
                                            <option value="Science">Science</option>
                                            <option value="Maths">Maths</option>
                                            <option value="Social">Social</option>
                                            <option value="English">English</option>
                                            <option value="Tamil">Tamil</option>
                                        </select>
                                        <label for="reg-subject">Fav Subject</label>
                                    </div>
                                </div>
                            </div>

                            <p id="register-message" class="text-danger fw-medium min-h-20 mb-3 text-center"></p>

                            <button type="submit"
                                class="btn btn-primary-custom w-100 py-3 fw-bold rounded-pill shadow-sm mb-4">Sign
                                Up</button>

                            <div class="d-flex align-items-center mb-4">
                                <hr class="flex-grow-1 bg-secondary opacity-25">
                                <span class="mx-3 text-muted small fw-medium text-uppercase">OR</span>
                                <hr class="flex-grow-1 bg-secondary opacity-25">
                            </div>

                            <!-- Social Buttons -->
                            <div class="row g-2 mb-4">
                                <div class="col-12">
                                    <!-- Google One Tap / Button Target -->
                                    <div class="g_id_signin w-100" data-type="standard" data-shape="rectangular"
                                        data-theme="outline" data-text="signup_with" data-size="large"
                                        data-logo_alignment="left">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button type="button"
                                        class="btn btn-outline-dark w-100 d-flex align-items-center justify-content-center gap-2 py-2"
                                        onclick="handleSocialLogin('Microsoft')">
                                        <img src="https://cdn-icons-png.flaticon.com/512/732/732221.png" width="20"
                                            height="20" alt="Microsoft Logo">
                                        <span>Sign up with Microsoft</span>
                                    </button>
                                </div>
                            </div>

                            <div class="mt-4 text-center small text-muted">
                                <p>Already have an account? <a href="#" onclick="showLogin(event)"
                                        class="text-primary-custom fw-bold ms-1">Login</a></p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Dashboard View -->
        <div id="teacher-view" class="view">

            <!-- Schedule Button -->
            <!-- Metrics Row (Top) -->
            <div id="teacher-metrics" class="row g-4 mb-4">
                <!-- Metrics injected here -->
            </div>

            <!-- Quick Actions Row -->
            <div class="d-flex gap-3 mb-4 overflow-auto pb-2">
                <button id="open-schedule-modal-btn"
                    class="btn btn-primary-custom shadow-sm d-flex align-items-center gap-2" data-bs-toggle="modal"
                    data-bs-target="#scheduleClassModal">
                    <span class="material-icons">videocam</span> Schedule Class
                </button>
                <button class="btn btn-warning shadow-sm d-flex align-items-center gap-2 text-dark fw-bold"
                    data-bs-toggle="modal" data-bs-target="#generateQuizModal">
                    <span class="material-icons">psychology</span> AI Quiz
                </button>
                <button class="btn btn-info shadow-sm d-flex align-items-center gap-2 text-white fw-bold"
                    data-bs-toggle="modal" data-bs-target="#lessonPlanModal">
                    <span class="material-icons">sticky_note_2</span> Plan Lesson
                </button>
                <button class="btn btn-dark shadow-sm d-flex align-items-center gap-2 text-white fw-bold"
                    onclick="openWhiteboard()">
                    <span class="material-icons">gesture</span> Whiteboard
                </button>
                <button class="btn btn-success shadow-sm d-flex align-items-center gap-2 text-white fw-bold"
                    onclick="exportTeacherData()">
                    <span class="material-icons">download</span> Export
                </button>
                <button class="btn btn-primary-custom shadow-sm d-flex align-items-center gap-2 text-white fw-bold"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border:none;"
                    data-bs-toggle="modal" data-bs-target="#engagementModal">
                    <span class="material-icons">auto_fix_high</span> Engagement Helper
                </button>
            </div>

            <div class="row g-4 mb-4">
                <!-- Left Col: Live Controls + Chart -->
                <div class="col-lg-8">
                    <!-- Live Class Controls -->
                    <div class="dashboard-card mb-4" style="background:#4D44B5; color:white;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="h5 fw-bold mb-0 text-white">Live Class Controls</h3>
                            <span class="badge bg-white text-primary">Now</span>
                        </div>
                        <div class="input-group">
                            <span class="input-group-text border-0"><span class="material-icons">link</span></span>
                            <input type="url" id="meet-link-input" class="form-control border-0"
                                placeholder="Google Meet Link">
                            <button id="start-class-btn" class="btn btn-success fw-bold"
                                onclick="startClass()">Start</button>
                            <button id="end-class-btn" class="btn btn-danger fw-bold" onclick="endClass()">End</button>
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="dashboard-card">
                        <h3 class="h5 fw-bold mb-3">Performance Distribution</h3>
                        <div id="class-performance-chart" style="height: 350px;"></div>
                    </div>
                </div>

                <!-- Right Col: Roster (Condensed?) or Calendar (Placeholder?) -->
                <!-- For now, put Roster here or full width below. Image shows Roster as full table. Let's make Roster full width below. 
                      Let's put a "Messages" or "Notice" placeholder here to match layout? 
                      Or just make Chart full width in Col-8 and leave Col-4 empty?
                      User instructions: "make project like this". Reference has "Agenda"/"Calendar" on right.
                  -->
                <div class="col-lg-4">
                    <div class="dashboard-card h-100-card">
                        <h3 class="h5 fw-bold mb-3">Calendar</h3>
                        <div class="text-center text-muted py-5">
                            <span class="material-icons" style="font-size:48px; opacity:0.3;">calendar_month</span>
                            <p>September 2030</p>
                            <!-- Placeholder for calendar visual -->
                        </div>
                        <h6 class="fw-bold mt-4">Upcoming events</h6>
                        <div class="d-flex align-items-center gap-3 mt-3 p-2 rounded bg-light">
                            <div class="bg-primary text-white rounded p-2 text-center" style="width:50px;">
                                <div class="small">10</div>
                                <div class="fw-bold">AM</div>
                            </div>
                            <div>
                                <div class="fw-bold">Math Review</div>
                                <div class="small text-muted">Grade 9</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <!-- Roster Full Width -->
            <div class="dashboard-card mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="h5 fw-bold mb-0">Class Roster</h3>
                    <button class="btn btn-sm btn-outline-primary rounded-pill">View All</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-custom align-middle">
                        <thead class="table-light bg-light">
                            <tr id="roster-header">
                                <!-- Header injected via JS -->
                            </tr>
                        </thead>
                        <tbody id="roster-table">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 2. Class Management View -->
        <div id="teacher-class-management-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">class</span> Class Management
            </h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold">My Classes</div>
                        <div class="list-group list-group-flush">
                            <button class="list-group-item list-group-item-action active">Grade 9 - Math (Sec
                                A)</button>
                            <button class="list-group-item list-group-item-action">Grade 10 - Physics (Sec B)</button>
                            <button class="list-group-item list-group-item-action">Grade 8 - Math (Sec C)</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold d-flex justify-content-between align-items-center">
                            <span>Student List (Grade 9-A)</span>
                            <button class="btn btn-sm btn-outline-primary">Export CSV</button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Attendance</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>S001</td>
                                        <td>Alice Smith</td>
                                        <td>95%</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                    </tr>
                                    <tr>
                                        <td>S002</td>
                                        <td>Bob Johnson</td>
                                        <td>88%</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                    </tr>
                                    <tr>
                                        <td>S003</td>
                                        <td>Charlie Brown</td>
                                        <td>92%</td>
                                        <td><span class="badge bg-success">Active</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Content & Assignments View -->
        <div id="teacher-content-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-warning fs-2">source</span> Content & Assignments
            </h2>
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-3">Upload Study Materials</h5>
                            <div class="border rounded p-4 text-center bg-light"
                                style="border-style: dashed !important;">
                                <span class="material-icons text-secondary fs-1">cloud_upload</span>
                                <p class="mb-2">Drag & Drop notes, PDFs, or slides here</p>
                                <button class="btn btn-primary-custom btn-sm">Browse Files</button>
                            </div>
                            <div class="mt-3">
                                <h6 class="text-muted small fw-bold uppercase">Recent Uploads</h6>
                                <ul class="list-group list-group-flush small">
                                    <li class="list-group-item d-flex justify-content-between">
                                        <span>Algebra_Notes_Ch1.pdf</span> <span class="text-success">Uploaded</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-3">Create Assignment</h5>
                            <form>
                                <div class="mb-3">
                                    <label class="form-label">Title</label>
                                    <input type="text" class="form-control" placeholder="e.g. Algebra Worksheet 1">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Due Date</label>
                                    <input type="date" class="form-control">
                                </div>
                                <div class="d-grid">
                                    <button type="button" class="btn btn-primary-custom">Assign to Class</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Assessment View -->
        <div id="teacher-assessment-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-danger fs-2">assignment_turned_in</span> Assessment & Grading
            </h2>
            <ul class="nav nav-pills mb-4">
                <li class="nav-item"><a class="nav-link active" href="#">Mark Attendance</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Gradebook</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Create Exam</a></li>
            </ul>
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="fw-bold">Today's Attendance - Grade 9A</h5>
                    <div class="table-responsive mt-3">
                        <table class="table table-bordered align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Student</th>
                                    <th class="text-center">Present</th>
                                    <th class="text-center">Absent</th>
                                    <th class="text-center">Late</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Alice Smith</td>
                                    <td class="text-center"><input type="radio" name="att_1" checked></td>
                                    <td class="text-center"><input type="radio" name="att_1"></td>
                                    <td class="text-center"><input type="radio" name="att_1"></td>
                                    <td><input type="text" class="form-control form-control-sm"></td>
                                </tr>
                                <tr>
                                    <td>Bob Johnson</td>
                                    <td class="text-center"><input type="radio" name="att_2" checked></td>
                                    <td class="text-center"><input type="radio" name="att_2"></td>
                                    <td class="text-center"><input type="radio" name="att_2"></td>
                                    <td><input type="text" class="form-control form-control-sm"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button class="btn btn-primary-custom mt-2">Save Attendance</button>
                </div>
            </div>
        </div>

        <!-- 5. Communication View -->
        <div id="teacher-communication-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-info fs-2">campaign</span> Communication Center
            </h2>
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold"> Announce to Class</div>
                        <div class="card-body p-4">
                            <div class="mb-3">
                                <label class="form-label">Select Classes</label>
                                <select class="form-select" multiple>
                                    <option selected>Grade 9 - Math</option>
                                    <option>Grade 10 - Physics</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Message</label>
                                <textarea class="form-control" rows="4"
                                    placeholder="Type your announcement..."></textarea>
                            </div>
                            <button class="btn btn-primary-custom w-100">Post Announcement</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold"> Recent Messages</div>
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Mrs. Johnson (Parent)</h6>
                                    <small>10 mins ago</small>
                                </div>
                                <p class="mb-1 small text-muted">Regarding Bob's absence yesterday?</p>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Principal</h6>
                                    <small>1 hr ago</small>
                                </div>
                                <p class="mb-1 small text-muted">Staff meeting at 4 PM.</p>
                            </a>
                        </div>
                        <div class="card-footer bg-white border-0 text-center">
                            <button class="btn btn-sm btn-outline-primary">View All Messages</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Super Admin View -->
        <div id="super-admin-view" class="view">
            <h2 class="mb-4 fw-bold">Super Admin Dashboard</h2>
            <div class="row g-4 mb-4">
                <div class="col-12" id="super-admin-content">
                    <!-- Content injected by JS -->
                </div>
            </div>
        </div>

        <!-- REPORTS VIEW -->
        <div id="reports-view" class="view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold m-0">Reports & Analytics</h2>
                <div class="btn-group">
                    <button class="btn btn-outline-primary" onclick="exportReportCSV()">
                        <span class="material-icons align-middle me-1">download</span> CSV
                    </button>
                    <button class="btn btn-outline-primary" onclick="window.print()">
                        <span class="material-icons align-middle me-1">picture_as_pdf</span> PDF
                    </button>
                </div>
            </div>

            <!-- Top Metrics Row (Finance & Staff) -->
            <div class="row g-4 mb-4" id="reports-metrics-row">
                <!-- Injected via JS -->
            </div>

            <div class="row g-4 mb-4">
                <div class="col-lg-6">
                    <div class="dashboard-card h-100-card">
                        <h3 class="h5 fw-bold mb-3">Attendance Trends</h3>
                        <div id="attendance-chart" style="height: 250px;"></div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="dashboard-card h-100-card">
                        <h3 class="h5 fw-bold mb-3">Academic Performance</h3>
                        <div id="academic-chart" style="height: 250px;"></div>
                    </div>
                </div>
            </div>

            <div class="row g-4 mb-4">
                <div class="col-lg-6">
                    <div class="dashboard-card h-100-card">
                        <h3 class="h5 fw-bold mb-3">Financial Summaries</h3>
                        <div id="finance-details-content">
                            <div class="d-flex justify-content-center align-items-center h-100 text-muted">Loading...
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="dashboard-card h-100-card">
                        <h3 class="h5 fw-bold mb-3">Staff Utilization</h3>
                        <div id="staff-details-content">
                            <div class="d-flex justify-content-center align-items-center h-100 text-muted">Loading...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="h5 fw-bold m-0">Custom Reports (Per Tenant)</h3>
                    <button class="btn btn-sm btn-light border"
                        onclick="alert('Custom Report Builder feature coming soon!')">
                        <span class="material-icons align-middle" style="font-size:18px">tune</span> Configure
                    </button>
                </div>
                <p class="text-muted small">Generate specific reports based on tenant data.</p>
                <div class="table-responsive">
                    <table class="table table-custom">
                        <thead>
                            <tr>
                                <th>Report Name</th>
                                <th>Type</th>
                                <th>Generated</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Monthly Fee Collection</td>
                                <td>Finance</td>
                                <td>Jan 15, 2026</td>
                                <td><span class="badge bg-success">Ready</span></td>
                                <td><button class="btn btn-sm btn-link">Download</button></td>
                            </tr>
                            <tr>
                                <td>Quarterly Staff Hours</td>
                                <td>HR</td>
                                <td>Jan 10, 2026</td>
                                <td><span class="badge bg-success">Ready</span></td>
                                <td><button class="btn btn-sm btn-link">Download</button></td>
                            </tr>
                            <tr>
                                <td>Student At-Risk Analysis</td>
                                <td>Academic</td>
                                <td>Jan 20, 2026</td>
                                <td><span class="badge bg-warning text-dark">Processing</span></td>
                                <td><button class="btn btn-sm btn-link disabled">Wait</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ACADEMICS VIEW -->
        <!-- ACADEMICS VIEW -->
        <div id="academics-view" class="view">
            <h2 class="mb-4 fw-bold text-primary-custom">Academic Management</h2>
            <div class="row h-100">
                <!-- Sub Menu Sidebar -->
                <div class="col-md-3">
                    <div class="list-group shadow-sm rounded-3">
                        <button class="list-group-item list-group-item-action active fw-bold py-3"
                            onclick="switchAcademicTab('planning', this)">
                            <span class="material-icons align-middle me-2">menu_book</span> Subject Planning
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchAcademicTab('classes', this)">
                            <span class="material-icons align-middle me-2">schedule</span> Class Schedules
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchAcademicTab('attendance', this)">
                            <span class="material-icons align-middle me-2">fact_check</span> Attendance Tracking
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchAcademicTab('assignments', this)">
                            <span class="material-icons align-middle me-2">assignment</span> Homework & Assignments
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchAcademicTab('exams', this)">
                            <span class="material-icons align-middle me-2">quiz</span> Exams & Grading
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchAcademicTab('reports', this)">
                            <span class="material-icons align-middle me-2">assessment</span> Report Cards
                        </button>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="col-md-9">
                    <div class="dashboard-card h-100 bg-white" id="academic-content-area">
                        <!-- Content injected by script.js -->
                        <div class="text-center p-5">
                            <div class="spinner-border text-primary"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- FINANCE VIEW -->
        <div id="finance-view" class="view">
            <h2 class="mb-4 fw-bold">Finance</h2>
            <div class="row g-4 mb-4">
                <!-- Summary Cards -->
                <div class="col-md-4">
                    <div class="dashboard-card widget-green h-100">
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-white fw-medium">Total Revenue</span>
                            <span class="material-icons text-white">account_balance_wallet</span>
                        </div>
                        <h3 class="fw-bold text-white mb-0">$1,250,000</h3>
                        <span class="text-white small opacity-75"> 8% from last year</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="dashboard-card widget-yellow h-100">
                        <div class="d-flex justify-content-between mb-3">
                            <span class="fw-medium" style="color:#303972">Pending Fees</span>
                            <span class="material-icons" style="color:#303972">pending</span>
                        </div>
                        <h3 class="fw-bold mb-0" style="color:#303972">$45,200</h3>
                        <span class="small opacity-75" style="color:#303972">Due this month</span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="dashboard-card widget-purple h-100">
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-white fw-medium">Expenses</span>
                            <span class="material-icons text-white">trending_down</span>
                        </div>
                        <h3 class="fw-bold text-white mb-0">$850,000</h3>
                        <span class="text-white small opacity-75"> 2% savings</span>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-lg-12">
                    <div class="dashboard-card">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4 class="fw-bold mb-0">Recent Transactions</h4>
                            <button class="btn btn-sm btn-outline-primary rounded-pill">View All</button>
                        </div>
                        <table class="table align-middle">
                            <thead class="text-muted small text-uppercase">
                                <tr>
                                    <th>Transaction ID</th>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>#TXN-8823</td>
                                    <td>Oct 12, 2025</td>
                                    <td>Tuition Payment - Alice Smith</td>
                                    <td><span class="badge bg-success-subtle text-success">Completed</span></td>
                                    <td class="text-end fw-bold">+$2,400.00</td>
                                </tr>
                                <tr>
                                    <td>#TXN-8824</td>
                                    <td>Oct 12, 2025</td>
                                    <td>Lab Equipment Purchase</td>
                                    <td><span class="badge bg-secondary-subtle text-secondary">Pending</span></td>
                                    <td class="text-end fw-bold text-danger">-$1,250.00</td>
                                </tr>
                                <tr>
                                    <td>#TXN-8825</td>
                                    <td>Oct 11, 2025</td>
                                    <td>Cafeteria Vendor Payment</td>
                                    <td><span class="badge bg-success-subtle text-success">Completed</span></td>
                                    <td class="text-end fw-bold text-danger">-$500.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMMUNICATION VIEW -->
        <div id="communication-view" class="view">
            <h2 class="mb-4 fw-bold text-primary-custom">Communication & Engagement</h2>
            <div class="row h-100">
                <!-- Sub Menu Sidebar -->
                <div class="col-md-3">
                    <div class="list-group shadow-sm rounded-3">
                        <button class="list-group-item list-group-item-action active fw-bold py-3"
                            onclick="switchCommTab('announcements', this)">
                            <span class="material-icons align-middle me-2">campaign</span> Announcements
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchCommTab('messaging', this)">
                            <span class="material-icons align-middle me-2">forum</span> Teacher-Parent Msg
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchCommTab('notifications', this)">
                            <span class="material-icons align-middle me-2">mark_email_unread</span> Email & SMS
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchCommTab('push', this)">
                            <span class="material-icons align-middle me-2">notifications_active</span> Push
                            Notifications
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3"
                            onclick="switchCommTab('calendar', this)">
                            <span class="material-icons align-middle me-2">event</span> Event Calendars
                        </button>
                        <button class="list-group-item list-group-item-action fw-bold py-3 text-danger"
                            onclick="switchCommTab('emergency', this)">
                            <span class="material-icons align-middle me-2">warning</span> Emergency Alerts
                        </button>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="col-md-9">
                    <div class="dashboard-card h-100 bg-white" id="comm-content-area">
                        <!-- Content injected by script.js -->
                        <div class="text-center p-5">
                            <div class="spinner-border text-primary"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>

        <!-- GRADE HELPER VIEW -->
        <div id="grade-helper-view" class="view">
            <h2 class="mb-4 fw-bold text-primary-custom">Grade Helper AI</h2>
            <div class="row h-100">
                <div class="col-lg-12">
                    <div class="dashboard-card h-100 d-flex flex-column" style="min-height: 600px;">
                        <div class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-3">
                            <div class="d-flex align-items-center gap-3">
                                <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center"
                                    style="width: 48px; height: 48px;">
                                    <span class="material-icons">school</span>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-0">Grade Specialist</h5>
                                    <small class="text-muted">Your personal grade-level assistant</small>
                                </div>
                            </div>
                            <span
                                class="badge bg-success-subtle text-success border border-success px-3 py-2 rounded-pill">Online</span>
                        </div>

                        <!-- Chat Area -->
                        <div id="grade-helper-chat-messages" class="flex-grow-1 overflow-auto p-3 mb-3 bg-light rounded"
                            style="max-height: 450px;">
                            <div class="d-flex align-items-start gap-3 mb-3">
                                <div class="rounded-circle bg-info text-white d-flex align-items-center justify-content-center flex-shrink-0"
                                    style="width: 36px; height: 36px;">AI</div>
                                <div class="bg-white p-3 rounded shadow-sm" style="max-width: 80%;">
                                    <p class="mb-0 text-dark">Hello! I am your Grade Helper. How can I assist you with
                                        your grade-related tasks today?</p>
                                </div>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <form id="grade-helper-form" onsubmit="handleGradeChat(event)">
                            <div class="input-group">
                                <input type="text" id="grade-helper-input"
                                    class="form-control form-control-lg border-0 bg-light"
                                    placeholder="Ask about your grade syllabus, homework, or teaching plans..."
                                    required>
                                <button type="submit" class="btn btn-primary-custom px-4">
                                    <span class="material-icons">send</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS VIEW -->
        <div id="settings-view" class="view">
            <h2 class="mb-4 fw-bold">Settings</h2>
            <div class="row g-4">
                <div class="col-lg-4">
                    <div class="dashboard-card">
                        <div class="text-center mb-4">
                            <div
                                style="width: 80px; height: 80px; background: #EBEDF6; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 32px; color: #4D44B5;">
                                <span class="material-icons">person</span>
                            </div>
                            <h5 class="fw-bold mt-3 mb-1">Linda Adora</h5>
                            <p class="text-muted small">School Admin</p>
                            <button class="btn btn-sm btn-outline-primary rounded-pill mt-2">Edit Profile</button>
                        </div>
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action border-0 fw-medium active"
                                style="background-color: #F3F4FF; color: #4D44B5; border-radius: 10px;">General
                                Settings</a>
                            <a href="#" class="list-group-item list-group-item-action border-0 fw-medium">Notification
                                Preferences</a>
                            <a href="#" class="list-group-item list-group-item-action border-0 fw-medium">Security &
                                Password</a>
                            <a href="#"
                                class="list-group-item list-group-item-action border-0 fw-medium text-danger">Deactivate
                                Account</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="dashboard-card h-100-card">
                        <h4 class="fw-bold mb-4">General Settings</h4>
                        <form>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">First Name</label>
                                    <input type="text" class="form-control" value="Linda">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Last Name</label>
                                    <input type="text" class="form-control" value="Adora">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted">Email Address</label>
                                <input type="email" class="form-control" value="linda@schoolhub.com">
                            </div>
                            <div class="mb-3">
                                <label class="form-label small fw-bold text-muted">School Name</label>
                                <input type="text" class="form-control" value="Noble Nexus High">
                            </div>
                            <div class="mb-4">
                                <label class="form-label small fw-bold text-muted">Timezone</label>
                                <select class="form-select">
                                    <option>(GMT -05:00) Eastern Time</option>
                                    <option>(GMT +00:00) UTC</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary-custom">Save Changes</button>
                        </form>
                    </div>

                    <!-- Invite Users Section (Moved from Sidebar) -->
                    <div id="invite-section" class="dashboard-card mt-4 d-none">
                        <h4 class="fw-bold mb-4">Invite Users</h4>
                        <p class="text-muted small mb-3">Generate secure invitation tokens for new users.</p>
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label small fw-bold text-muted">Select Role</label>
                                <select class="form-select" id="invite-role">
                                    <option value="Student">Student</option>
                                    <option value="Parent">Parent</option>
                                    <option value="Teacher">Teacher</option>
                                </select>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button class="btn btn-primary-custom w-100" onclick="generateInvite()">
                                    <span class="material-icons align-middle me-1"
                                        style="font-size: 18px;">add_link</span> Generate
                                </button>
                            </div>
                        </div>
                        <div id="invite-result"
                            class="mt-3 p-3 rounded bg-light border d-none text-center fw-bold text-primary"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMPLIANCE View -->
        <div id="compliance-view" class="view">
            <div class="d-flex align-items-center mb-4 gap-3">
                <button id="compliance-back-btn" class="btn btn-white border shadow-sm rounded-circle d-none"
                    onclick="showComplianceMenu()"
                    style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;">
                    <span class="material-icons">arrow_back</span>
                </button>
                <h2 id="compliance-top-title" class="fw-bold m-0">Compliance & Security</h2>
            </div>

            <!-- Menu Area -->
            <div id="compliance-menu-area" class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="bg-light">
                            <tr>
                                <th class="py-3 ps-4" style="width: 25%;">Sub Menu</th>
                                <th class="py-3">Functionality</th>
                                <th class="py-3">Permission</th>
                                <th class="py-3">Role</th>
                                <th class="py-3 text-end pe-4">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="cursor: pointer;" onclick="loadComplianceTab('audit-logs')">
                                <td class="ps-4 fw-bold text-primary">Audit logs</td>
                                <td class="text-muted small">View comprehensive system audit trail</td>
                                <td><span class="badge bg-primary-subtle text-primary">compliance.view</span></td>
                                <td><small class="text-secondary">Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadComplianceTab('retention')">
                                <td class="ps-4 fw-bold text-primary">Data retention policies</td>
                                <td class="text-muted small">Configure data lifecycle and deletion</td>
                                <td><span class="badge bg-warning-subtle text-warning">compliance.manage</span></td>
                                <td><small class="text-secondary">Super Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadComplianceTab('access-logs')">
                                <td class="ps-4 fw-bold text-primary">Access logs</td>
                                <td class="text-muted small">Monitor login and authentication events</td>
                                <td><span class="badge bg-primary-subtle text-primary">compliance.view</span></td>
                                <td><small class="text-secondary">Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dynamic Content Area (Full Page Mode) -->
            <div id="compliance-detail-area" class="d-none animate-fade-in">
                <!-- Content injected here -->
                <div id="compliance-tab-content"></div>
            </div>
        </div>

        <!-- FINANCE View -->
        <div id="finance-view" class="view">
            <div class="d-flex align-items-center mb-4 gap-3">
                <button id="finance-back-btn" class="btn btn-white border shadow-sm rounded-circle d-none"
                    onclick="showFinanceMenu()"
                    style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;">
                    <span class="material-icons">arrow_back</span>
                </button>
                <h2 id="finance-top-title" class="fw-bold m-0">3.6 Finance & Billing</h2>
            </div>

            <!-- Menu Area -->
            <div id="finance-menu-area" class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="bg-light">
                            <tr>
                                <th class="py-3 ps-4" style="width: 25%;">Sub Menu</th>
                                <th class="py-3">Functionality</th>
                                <th class="py-3">Permission</th>
                                <th class="py-3">Role</th>
                                <th class="py-3 text-end pe-4">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('fee-structures')">
                                <td class="ps-4 fw-bold text-primary">Fee structures</td>
                                <td class="text-muted small">Manage tuition and fee categories</td>
                                <td><span class="badge bg-warning-subtle text-warning">finance.manage</span></td>
                                <td><small class="text-secondary">Finance Officer</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('installment-plans')">
                                <td class="ps-4 fw-bold text-primary">Installment plans</td>
                                <td class="text-muted small">Configure payment schedules</td>
                                <td><span class="badge bg-warning-subtle text-warning">finance.manage</span></td>
                                <td><small class="text-secondary">Finance Officer</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('discounts-scholarships')">
                                <td class="ps-4 fw-bold text-primary">Discounts & scholarships</td>
                                <td class="text-muted small">Manage financial aid and offers</td>
                                <td><span class="badge bg-warning-subtle text-warning">finance.manage</span></td>
                                <td><small class="text-secondary">Finance Officer</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('invoicing')">
                                <td class="ps-4 fw-bold text-primary">Invoicing</td>
                                <td class="text-muted small">Generate and send bills</td>
                                <td><span class="badge bg-primary-subtle text-primary">finance.view</span></td>
                                <td><small class="text-secondary">Finance Officer</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('online-payments')">
                                <td class="ps-4 fw-bold text-primary">Online payments</td>
                                <td class="text-muted small">Payment gateway integration settings</td>
                                <td><span class="badge bg-warning-subtle text-warning">finance.manage</span></td>
                                <td><small class="text-secondary">Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('refunds')">
                                <td class="ps-4 fw-bold text-primary">Refunds</td>
                                <td class="text-muted small">Process refund requests</td>
                                <td><span class="badge bg-warning-subtle text-warning">finance.manage</span></td>
                                <td><small class="text-secondary">Finance Officer</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('financial-reports')">
                                <td class="ps-4 fw-bold text-primary">Financial reports</td>
                                <td class="text-muted small">Revenue, expenses, and tax reports</td>
                                <td><span class="badge bg-primary-subtle text-primary">finance.view</span></td>
                                <td><small class="text-secondary">Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadFinanceTab('multi-currency')">
                                <td class="ps-4 fw-bold text-primary">Multi-currency (platform-level)</td>
                                <td class="text-muted small">Manage supported currencies and rates</td>
                                <td><span class="badge bg-danger-subtle text-danger">root.manage</span></td>
                                <td><small class="text-secondary">Super Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dynamic Content Area -->
            <div id="finance-detail-area" class="d-none animate-fade-in">
                <div id="finance-tab-content"></div>
            </div>
        </div>

        </div>

        <!-- STAFF & FACULTY View -->
        <div id="staff-view" class="view">
            <div class="d-flex align-items-center mb-4 gap-3">
                <button id="staff-back-btn" class="btn btn-white border shadow-sm rounded-circle d-none"
                    onclick="showStaffMenu()"
                    style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;">
                    <span class="material-icons">arrow_back</span>
                </button>
                <h2 id="staff-top-title" class="fw-bold m-0">3.4 Staff & Faculty Management</h2>
            </div>

            <!-- Menu Area -->
            <div id="staff-menu-area" class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="bg-light">
                            <tr>
                                <th class="py-3 ps-4" style="width: 25%;">Sub Menu</th>
                                <th class="py-3">Functionality</th>
                                <th class="py-3">Permission</th>
                                <th class="py-3">Role</th>
                                <th class="py-3 text-end pe-4">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="cursor: pointer;" onclick="loadStaffTab('profiles')">
                                <td class="ps-4 fw-bold text-primary">Staff profiles</td>
                                <td class="text-muted small">Manage staff records</td>
                                <td><span class="badge bg-primary-subtle text-primary">staff.view</span></td>
                                <td><small class="text-secondary">HR Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStaffTab('role-assignment')">
                                <td class="ps-4 fw-bold text-primary">Role assignment</td>
                                <td class="text-muted small">Assign system roles</td>
                                <td><span class="badge bg-warning-subtle text-warning">role.manage</span></td>
                                <td><small class="text-secondary">Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStaffTab('department-grouping')">
                                <td class="ps-4 fw-bold text-primary">Department grouping</td>
                                <td class="text-muted small">Organize staff by department</td>
                                <td><span class="badge bg-warning-subtle text-warning">staff.manage</span></td>
                                <td><small class="text-secondary">HR Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStaffTab('workload')">
                                <td class="ps-4 fw-bold text-primary">Workload allocation</td>
                                <td class="text-muted small">Manage class schedules and duties</td>
                                <td><span class="badge bg-warning-subtle text-warning">staff.manage</span></td>
                                <td><small class="text-secondary">Academic Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStaffTab('attendance')">
                                <td class="ps-4 fw-bold text-primary">Attendance</td>
                                <td class="text-muted small">Track staff attendance</td>
                                <td><span class="badge bg-primary-subtle text-primary">staff.view</span></td>
                                <td><small class="text-secondary">HR Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStaffTab('payroll')">
                                <td class="ps-4 fw-bold text-primary">Payroll integration</td>
                                <td class="text-muted small">Sync with payroll systems</td>
                                <td><span class="badge bg-warning-subtle text-warning">finance.view</span></td>
                                <td><small class="text-secondary">Finance Officer</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStaffTab('performance')">
                                <td class="ps-4 fw-bold text-primary">Performance reviews</td>
                                <td class="text-muted small">Manage staff evaluations</td>
                                <td><span class="badge bg-warning-subtle text-warning">staff.manage</span></td>
                                <td><small class="text-secondary">HR Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dynamic Content Area -->
            <div id="staff-detail-area" class="d-none animate-fade-in">
                <div id="staff-tab-content"></div>
            </div>
        </div>

        <!-- STUDENT INFORMATION View -->
        <div id="student-info-view" class="view">
            <div class="d-flex align-items-center mb-4 gap-3">
                <button id="student-info-back-btn" class="btn btn-white border shadow-sm rounded-circle d-none"
                    onclick="showStudentInfoMenu()"
                    style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;">
                    <span class="material-icons">arrow_back</span>
                </button>
                <h2 id="student-info-top-title" class="fw-bold m-0">3.3 Student Information Management</h2>
            </div>

            <!-- Menu Area -->
            <div id="student-info-menu-area" class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="bg-light">
                            <tr>
                                <th class="py-3 ps-4" style="width: 30%;">Sub Menu</th>
                                <th class="py-3">Functionality</th>
                                <th class="py-3">Permission</th>
                                <th class="py-3">Role</th>
                                <th class="py-3 text-end pe-4">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="cursor: pointer;" onclick="loadStudentInfoTab('profiles')">
                                <td class="ps-4 fw-bold text-primary">Student profiles & Enrollment history</td>
                                <td class="text-muted small">View records and academic history</td>
                                <td><span class="badge bg-primary-subtle text-primary">student.info.view</span></td>
                                <td><small class="text-secondary">All Staff</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStudentInfoTab('class-assignment')">
                                <td class="ps-4 fw-bold text-primary">Class & section assignment</td>
                                <td class="text-muted small">Manage enrollment structure</td>
                                <td><span class="badge bg-warning-subtle text-warning">student.info.manage</span></td>
                                <td><small class="text-secondary">Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStudentInfoTab('guardians')">
                                <td class="ps-4 fw-bold text-primary">Guardian relationships</td>
                                <td class="text-muted small">Contact info and relations</td>
                                <td><span class="badge bg-primary-subtle text-primary">student.info.view</span></td>
                                <td><small class="text-secondary">All Staff</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStudentInfoTab('health')">
                                <td class="ps-4 fw-bold text-primary">Health & emergency info</td>
                                <td class="text-muted small">Medical records and contacts</td>
                                <td><span class="badge bg-primary-subtle text-primary">student.info.view</span></td>
                                <td><small class="text-secondary">Nurse / Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                            <tr style="cursor: pointer;" onclick="loadStudentInfoTab('documents')">
                                <td class="ps-4 fw-bold text-primary">Documents (ID, certificates)</td>
                                <td class="text-muted small">Manage official documents</td>
                                <td><span class="badge bg-warning-subtle text-warning">student.info.manage</span></td>
                                <td><small class="text-secondary">Admin</small></td>
                                <td class="text-end pe-4"><span class="material-icons text-muted">chevron_right</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dynamic Content Area -->
            <div id="student-info-detail-area" class="d-none animate-fade-in">
                <div id="student-info-tab-content"></div>
            </div>
        </div>

        <!-- Groups Management View -->
        <!-- Groups Management View (DISABLED) -->
        <!-- 
        <div id="groups-view" class="view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold"> Learning Management System (LMS)</h2>
                <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#createGroupModal">
                    <span class="material-icons align-middle fs-5 me-1">add</span> Create Course
                </button>
            </div>
            <div id="groups-list" class="row g-4">
            </div>
        </div>
        -->



        <!-- Lesson Plan Modal -->
        <div class="modal fade" id="lessonPlanModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg">
                    <div class="modal-header bg-info text-white">
                        <h5 class="modal-title fw-bold"> AI Lesson Planner</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Topic</label>
                                <input type="text" id="lp-topic" class="form-control" placeholder="e.g. Photosynthesis">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Grade</label>
                                <input type="number" id="lp-grade" class="form-control" value="9">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Subject</label>
                                <select id="lp-subject" class="form-select">
                                    <option>Science</option>
                                    <option>Maths</option>
                                    <option>English</option>
                                    <option>Social</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Duration (Minutes)</label>
                                <input type="range" class="form-range" id="lp-duration" min="15" max="120" step="5"
                                    value="30"
                                    oninput="document.getElementById('duration-val').innerText = this.value + ' mins'">
                                <div class="text-center fw-bold text-primary-custom" id="duration-val">30 mins</div>
                            </div>
                            <!-- Added Description Field -->
                            <div class="col-12">
                                <label class="form-label">Additional Instructions / Context</label>
                                <textarea id="lp-description" class="form-control" rows="3"
                                    placeholder="e.g. Focus on vocabulary, include a group activity..."></textarea>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Upload PDF Context (Optional)</label>
                                <input type="file" class="form-control" id="lp-pdf" accept=".pdf">
                            </div>
                        </div>

                        <div id="lp-loading" class="text-center mt-4 d-none">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p class="mt-2 text-muted">Thinking...</p>
                        </div>
                        <div id="lp-result" class="mt-4 p-3 bg-light rounded border d-none"
                            style="white-space: pre-wrap; font-family: sans-serif;"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary-custom fw-bold" onclick="generateLessonPlan()">
                            <span class="material-icons align-middle fs-6 me-1">auto_awesome</span> Generate Plan
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Take Quiz Modal -->
        <div class="modal fade" id="takeQuizModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content border-0 shadow-lg">
                    <div class="modal-header bg-primary-custom text-white">
                        <h5 class="modal-title fw-bold" id="take-quiz-title">Quiz</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <form id="quiz-form">
                            <div id="quiz-questions-container">
                                <!-- Questions Injected Here -->
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer bg-light">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary-custom fw-bold"
                            onclick="submitQuizAnswers()">Submit Quiz</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Audit View -->
        <div id="admin-view" class="view">
            <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
                <h2 class="fw-bold m-0 d-flex align-items-center gap-2">
                    <span class="material-icons text-danger fs-2">admin_panel_settings</span> Admin Dashboard
                </h2>
                <button class="btn btn-outline-secondary d-flex align-items-center gap-2 fw-bold"
                    onclick="switchView('teacher-view')">
                    <span class="material-icons">arrow_back</span> Back to Dashboard
                </button>
            </div>

            <!-- School Management Section -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h5 class="fw-bold m-0 text-primary-custom d-flex align-items-center gap-2">
                        <span class="material-icons">domain</span> School Management
                    </h5>
                </div>
                <div class="card-body p-4">
                    <form id="create-school-form" onsubmit="handleCreateSchool(event)">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-3">
                                <label class="form-label fw-bold small">School Name</label>
                                <input type="text" class="form-control" id="new-school-name"
                                    placeholder="e.g. Springfield High" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold small">Address</label>
                                <input type="text" class="form-control" id="new-school-address"
                                    placeholder="123 Main St, City" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold small">Contact Email</label>
                                <input type="email" class="form-control" id="new-school-email"
                                    placeholder="admin@school.edu" required>
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary-custom w-100 fw-bold">
                                    <span class="material-icons align-middle fs-6 me-1">add_circle</span> Create
                                </button>
                            </div>
                        </div>
                    </form>
                    <div id="create-school-msg" class="mt-2 small fw-bold"></div>
                </div>
            </div>

            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h5 class="fw-bold m-0 text-danger d-flex align-items-center gap-2">
                        <span class="material-icons">security</span> Security Audit Logs
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div id="audit-logs-container" class="table-responsive">
                        <div class="p-5 text-center text-muted">
                            <div class="spinner-border text-primary mb-3" role="status"></div>
                            <p>Loading security records...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Student View -->
        <!-- Student View -->
        <div id="student-view" class="view">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 id="student-name-header" class="fw-bold mb-0">Student Dashboard</h2>
                <button id="student-log-activity-btn" class="btn btn-primary-custom shadow-sm"
                    onclick="openStudentAddActivityModal()">
                    <span class="material-icons align-middle fs-5 me-1">add_task</span> Log Activity
                </button>
            </div>

            <!-- Live Class Banner -->


            <div id="student-live-banner"
                class="alert alert-danger d-none d-flex justify-content-between align-items-center shadow-sm"
                role="alert">
                <div class="d-flex align-items-center gap-2">
                    <span class="spinner-grow spinner-grow-sm text-danger" role="status"></span>
                    <strong> Live Class in Progress!</strong>
                </div>
                <div class="d-flex gap-2">
                    <a id="student-join-link" href="#" target="_blank" class="btn btn-sm btn-danger fw-bold">Join
                        Class</a>
                    <button class="btn btn-sm btn-dark fw-bold" onclick="openWhiteboard()">Join Whiteboard</button>
                </div>
            </div>

            <!-- Metrics -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h3 class="h5 text-secondary fw-bold mb-3">Student Key Metrics</h3>
                    <div id="student-metrics" class="row g-4">
                        <!-- Metrics injected here -->
                    </div>
                </div>
            </div>

            <!-- Live Classes -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h3 class="h5 text-danger fw-bold mb-3 d-flex align-items-center">
                        <span class="material-icons me-2">live_tv</span> Upcoming Live Classes
                    </h3>
                    <div id="live-classes-list">
                        <p class="text-muted">No live classes scheduled.</p>
                    </div>
                </div>
            </div>

            <!-- Live Banner -->
            <div id="student-live-banner"
                class="live-class-banner text-white p-3 rounded-3 mb-4 d-none justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-2 fw-bold">
                    <span class="spinner-grow spinner-grow-sm bg-white" role="status"></span>
                    LIVE CLASS IN SESSION
                </div>
                <a id="student-join-link" href="#" target="_blank" class="btn btn-light text-danger fw-bold">JOIN
                    NOW</a>
            </div>

            <!-- Gamification Bar -->
            <div class="card border-0 shadow-sm mb-4 bg-primary-custom text-white overflow-hidden position-relative">
                <div class="card-body p-4 position-relative" style="z-index: 1;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h4 class="mb-0 fw-bold d-flex align-items-center gap-2">
                            <span class="material-icons text-warning">emoji_events</span> Level <span
                                id="student-level">1</span>
                        </h4>
                        <span class="badge bg-white text-primary fw-bold fs-6 shadow-sm"><span id="student-xp">0</span>
                            XP</span>
                    </div>
                    <div class="progress bg-white bg-opacity-25" style="height: 10px; border-radius: 10px;">
                        <div id="student-xp-bar" class="progress-bar bg-warning" role="progressbar" style="width: 0%">
                        </div>
                    </div>
                    <div id="student-badges" class="d-flex mt-3 gap-2 flex-wrap">
                        <!-- Badges injected here -->
                    </div>
                </div>
                <!-- Decorative Circles -->
                <div class="position-absolute top-0 end-0 bg-white opacity-10 rounded-circle"
                    style="width: 150px; height: 150px; transform: translate(30%, -30%);"></div>
                <div class="position-absolute bottom-0 start-0 bg-white opacity-10 rounded-circle"
                    style="width: 100px; height: 100px; transform: translate(-30%, 30%);"></div>
            </div>

            <!-- Student Groups (Subject Hubs) -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h3 class="h5 text-primary-custom fw-bold mb-3 d-flex align-items-center">
                        <span class="material-icons me-2">class</span> My Courses
                    </h3>
                    <div id="student-groups-list" class="row g-3">
                        <p class="text-muted small">You are not enrolled in any courses yet.</p>
                    </div>
                </div>
            </div>

            <!-- Upcoming Assignments -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h3 class="h5 text-danger fw-bold mb-3 d-flex align-items-center">
                        <span class="material-icons me-2">assignment_late</span> Upcoming Assignments & Projects
                    </h3>
                    <div id="student-upcoming-assignments" class="list-group list-group-flush">
                        <p class="text-muted small">Loading assignments...</p>
                    </div>
                </div>
            </div>

            <!-- Recommendation Box -->
            <div id="recommendation-box" class="alert alert-info border-start border-4 border-info shadow-sm mb-4"
                style="display:none;"></div>

            <!-- Progress & History Tabs -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                    <ul class="nav nav-tabs card-header-tabs" id="studentTabs" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active fw-bold text-dark" id="progress-tab-btn" data-bs-toggle="tab"
                                data-bs-target="#progress-tab-pane" type="button"> Progress Graph</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link fw-bold text-muted" id="history-tab-btn" data-bs-toggle="tab"
                                data-bs-target="#history-tab-pane" type="button"> Activity History</button>
                        </li>
                    </ul>
                </div>
                <div class="card-body p-4">
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="progress-tab-pane" role="tabpanel">
                            <div id="student-progress-chart" style="height: 350px;"></div>
                        </div>
                        <div class="tab-pane fade" id="history-tab-pane" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <tbody id="history-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Removed AI Tutor Chat from here -->
        </div>

        <!-- Parent View (Observer Mode) -->
        <div id="parent-dashboard-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">family_restroom</span> Parent Portal
            </h2>

            <!-- Child Selector -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body p-4">
                    <label class="form-label fw-bold">Select Your Child</label>
                    <div class="input-group">
                        <input type="text" id="parent-child-id" class="form-control"
                            placeholder="Enter Child's Student ID (e.g., S001)">
                        <button class="btn btn-primary-custom" onclick="loadParentChildData()">View Progress</button>
                    </div>
                    <div class="form-text">Enter the Student ID provided by the school.</div>
                </div>
            </div>

            <div id="parent-dashboard-content" class="d-none">
                <h4 class="fw-bold text-secondary mb-3">Overview for <span id="parent-child-name"
                        class="text-dark"></span></h4>

                <!-- Parent Metrics -->
                <div id="parent-metrics" class="row g-4 mb-4">
                    <!-- Metrics injected here -->
                </div>

                <!-- Recent Updates Area -->
                <div class="alert alert-info border-start border-4 border-info shadow-sm">
                    <h5 class="alert-heading fw-bold d-flex align-items-center"><span
                            class="material-icons me-2">notifications_active</span> Key Updates</h5>
                    <ul class="mb-0 small">
                        <li>School closes early tomorrow at 2 PM.</li>
                        <li>Report cards have been published.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 2. Academic Progress View -->
        <div id="parent-academic-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">auto_stories</span> Academic Progress
            </h2>

            <div class="row g-4 mb-4">
                <div class="col-12">
                    <div class="alert alert-light border shadow-sm">
                        <h5 class="alert-heading fw-bold">Teacher Feedback</h5>
                        <p id="parent-feedback" class="mb-0 text-muted">Loading feedback...</p>
                    </div>
                </div>
            </div>

            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold">Recent Marks</div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Subject</th>
                                        <th>Exam</th>
                                        <th>Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Math</td>
                                        <td>Unit Test</td>
                                        <td class="text-success fw-bold">88%</td>
                                    </tr>
                                    <tr>
                                        <td>Science</td>
                                        <td>Lab</td>
                                        <td class="text-primary fw-bold">92%</td>
                                    </tr>
                                    <tr>
                                        <td>English</td>
                                        <td>Essay</td>
                                        <td class="text-warning fw-bold">75%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold">Performance Chart</div>
                        <div class="card-body">
                            <div id="parent-progress-chart" style="height: 250px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white fw-bold">Report Cards</div>
                        <div class="list-group list-group-flush">
                            <a href="#"
                                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <div><span class="material-icons align-middle text-danger me-2">picture_as_pdf</span>
                                    Term 1 Report</div>
                                <span class="badge bg-secondary">Download</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Attendance View -->
        <div id="parent-attendance-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">calendar_today</span> Attendance Records
            </h2>
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold m-0">Monthly Attendance</h5>
                        <div class="badge bg-primary fs-6">Overall: <span id="parent-attendance">--</span></div>
                    </div>
                    <div class="row g-3 text-center mb-4">
                        <div class="col-4">
                            <div class="p-3 bg-success bg-opacity-10 rounded">
                                <h3 class="fw-bold text-success mb-0">22</h3>
                                <small class="text-muted">Present</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-3 bg-danger bg-opacity-10 rounded">
                                <h3 class="fw-bold text-danger mb-0">1</h3>
                                <small class="text-muted">Absent</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-3 bg-warning bg-opacity-10 rounded">
                                <h3 class="fw-bold text-warning mb-0">0</h3>
                                <small class="text-muted">Late</small>
                            </div>
                        </div>
                    </div>
                    <p class="text-center text-muted">Calendar view coming soon.</p>
                </div>
            </div>
        </div>

        <!-- 4. Fees & Payments View -->
        <div id="parent-fees-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">payments</span> Fees & Payments
            </h2>
            <div class="row g-4">
                <div class="col-md-5">
                    <div class="card border-0 shadow-sm bg-primary-custom text-white">
                        <div class="card-body p-4">
                            <h6 class="text-uppercase opacity-75">Outstanding Balance</h6>
                            <h2 class="fw-bold display-5 mb-0">$1,200.00</h2>
                            <p class="small opacity-75 mb-4">Due by Oct 31, 2025</p>
                            <button class="btn btn-warning w-100 fw-bold text-dark">Pay Now</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold">Payment History</div>
                        <table class="table table-hover mb-0 small">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Sep 10</td>
                                    <td>Term 1 Tuition</td>
                                    <td>$2,000</td>
                                    <td><span class="badge bg-success">Paid</span></td>
                                </tr>
                                <tr>
                                    <td>Aug 15</td>
                                    <td>Lab Fees</td>
                                    <td>$150</td>
                                    <td><span class="badge bg-success">Paid</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. Communication View -->
        <div id="parent-communication-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">forum</span> Communication
            </h2>
            <div class="list-group">
                <a href="#"
                    class="list-group-item list-group-item-action p-4 border-start border-4 border-primary shadow-sm mb-3 rounded-end">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1 fw-bold">Parent-Teacher Meeting</h5>
                        <small>Yesterday</small>
                    </div>
                    <p class="mb-1">Scheduled for next Friday at 10 AM regarding Alice's progress.</p>
                    <small class="text-muted">From: Mrs. Johnson (Class Teacher)</small>
                </a>
                <a href="#"
                    class="list-group-item list-group-item-action p-4 border-start border-4 border-warning shadow-sm mb-3 rounded-end">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1 fw-bold">School Bus Delay</h5>
                        <small>2 days ago</small>
                    </div>
                    <p class="mb-1">Bus Route 4 will be delayed by 15 mins due to road work.</p>
                    <small class="text-muted">From: Transport Admin</small>
                </a>
            </div>
            <button class="btn btn-outline-primary d-flex align-items-center gap-2 mt-3">
                <span class="material-icons">send</span> Send Message to Teacher
            </button>
        </div>


        <!-- Profile View -->
        <div id="profile-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">account_circle</span> My Profile
            </h2>

            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                        <div class="card-header border-0 p-5 text-center text-white position-relative"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="position-absolute top-0 end-0 p-3">
                                <button
                                    class="btn btn-white btn-sm bg-white bg-opacity-25 text-white border-0 rounded-pill"
                                    onclick="handleLogout()">
                                    <span class="material-icons align-middle fs-6 me-1">logout</span> Logout
                                </button>
                            </div>
                            <img src="" id="profile-img-large"
                                class="rounded-circle shadow-sm border border-4 border-white mb-3" width="120"
                                height="120" style="object-fit: cover; background: white;">
                            <h3 class="fw-bold mb-1" id="profile-name">--</h3>
                            <p class="mb-0 opacity-75" id="profile-role">--</p>
                        </div>
                        <div class="card-body p-4 p-md-5">
                            <div class="row g-4">
                                <div class="col-6">
                                    <label class="small text-muted fw-bold text-uppercase">User ID</label>
                                    <p class="fs-5 fw-medium text-dark mb-0" id="profile-id">--</p>
                                </div>
                                <div class="col-6">
                                    <label class="small text-muted fw-bold text-uppercase">Email</label>
                                    <p class="fs-5 fw-medium text-dark mb-0" id="profile-email">--</p>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted fw-bold text-uppercase">Bio / Status</label>
                                    <p class="text-muted fst-italic mb-0">"Lifelong learner & educator."</p>
                                </div>
                            </div>

                            <hr class="my-4 bg-secondary opacity-10">

                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary py-2 fw-bold rounded-pill"
                                    onclick="alert('Edit Profile feature coming soon!')">
                                    Edit Profile
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        </div>
        </div>

        <!-- 2. My Academics View -->
        <div id="student-academics-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-primary-custom fs-2">menu_book</span> My Academics
            </h2>
            <div class="row g-4">
                <!-- Subjects Card -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-3"> Subjects & Syllabus</h5>
                            <div class="list-group list-group-flush">
                                <a href="#"
                                    class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <span>Mathematics</span> <span class="badge bg-primary rounded-pill">Ch 1-5</span>
                                </a>
                                <a href="#"
                                    class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <span>Science</span> <span class="badge bg-success rounded-pill">Physics</span>
                                </a>
                                <a href="#"
                                    class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <span>English</span> <span class="badge bg-info rounded-pill">Literature</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Timetable Card -->
                <div class="col-md-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-3"> Class Timetable</h5>
                            <div class="alert alert-light border">
                                <div class="d-flex justify-content-between mb-2">
                                    <strong>09:00 AM</strong> <span>Mathematics (Rm 101)</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <strong>10:30 AM</strong> <span>Science Lab</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <strong>01:00 PM</strong> <span>English History</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. Assignments & Exams View -->
        <div id="student-exams-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-danger fs-2">assignment</span> Assignments & Exams
            </h2>
            <ul class="nav nav-pills mb-4" id="exams-tabs" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active fw-bold" id="homework-tab-btn" data-bs-toggle="pill"
                        data-bs-target="#homework-tab">Homework</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link fw-bold" id="exams-tab-btn" data-bs-toggle="pill"
                        data-bs-target="#exams-tab">Exam Schedules</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link fw-bold" id="results-tab-btn" data-bs-toggle="pill"
                        data-bs-target="#results-tab">Results</button>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="homework-tab">
                    <div class="list-group">
                        <div class="list-group-item p-3 border-start border-4 border-warning">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1 fw-bold">Algebra Worksheet</h5>
                                <small class="text-danger fw-bold">Due Tomorrow</small>
                            </div>
                            <p class="mb-1">Complete exercises 5.1 to 5.5.</p>
                            <small class="text-muted">Math  Posted by Mr. Smith</small>
                        </div>
                        <div class="list-group-item p-3 border-start border-4 border-success mt-2">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1 fw-bold">Physics Lab Report</h5>
                                <small class="text-muted">Due in 3 days</small>
                            </div>
                            <p class="mb-1">Submit your findings on the pendulum experiment.</p>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="exams-tab">
                    <div class="alert alert-info">
                        <h5 class="alert-heading fw-bold"><span class="material-icons align-middle">event</span>
                            Mid-Term Exams</h5>
                        <p>Starting from Oct 15th. Check detailed schedule below.</p>
                        <hr>
                        <ul class="mb-0">
                            <li>Oct 15: Mathematics</li>
                            <li>Oct 17: Science</li>
                            <li>Oct 19: English</li>
                        </ul>
                    </div>
                </div>
                <div class="tab-pane fade" id="results-tab">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Exam</th>
                                        <th>Date</th>
                                        <th>Score</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Unit Test 1</td>
                                        <td>Sep 01</td>
                                        <td class="fw-bold text-success">85/100</td>
                                        <td><span class="badge bg-success">Passed</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Performance View -->
        <div id="student-performance-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-success fs-2">insights</span> Performance Analysis
            </h2>
            <div class="row g-4">
                <div class="col-md-8">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-3"> Academic Progress</h5>
                            <div class="d-flex align-items-end justify-content-between" style="height: 200px;">
                                <!-- Mock Chart Bars -->
                                <div class="w-100 d-flex justify-content-around h-100 align-items-end">
                                    <div class="bg-primary opacity-50 rounded-top text-center text-white pt-1"
                                        style="width: 15%; height: 60%">Unit 1<br>60%</div>
                                    <div class="bg-primary opacity-75 rounded-top text-center text-white pt-1"
                                        style="width: 15%; height: 75%">Unit 2<br>75%</div>
                                    <div class="bg-primary rounded-top text-center text-white pt-1"
                                        style="width: 15%; height: 85%">Mid<br>85%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-3"> Strengths</h5>
                            <span class="badge bg-success p-2 me-1 mb-2">Problem Solving</span>
                            <span class="badge bg-success p-2 me-1 mb-2">Physics</span>
                            <h5 class="fw-bold mb-3 mt-4"> Improvement Areas</h5>
                            <span class="badge bg-warning text-dark p-2 me-1 mb-2">Grammar</span>
                            <span class="badge bg-warning text-dark p-2 me-1 mb-2">History Dates</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. Communication View -->
        <div id="student-communication-view" class="view">
            <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
                <span class="material-icons text-info fs-2">forum</span> Communication Hub
            </h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold"> Notice Board</div>
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">School Closed</h6>
                                    <small>Today</small>
                                </div>
                                <small class="text-muted">Due to heavy rain.</small>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Sports Day</h6>
                                    <small>Yesterday</small>
                                </div>
                                <small class="text-muted">Register by Friday.</small>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white fw-bold"> Teacher Messages & Doubts</div>
                        <div
                            class="card-body d-flex flex-column justify-content-center align-items-center text-center text-muted">
                            <span class="material-icons fs-1 mb-2 opacity-50">chat_bubble_outline</span>
                            <h5>No new messages</h5>
                            <p>Ask a doubt or check back later for updates from your teachers.</p>
                            <button class="btn btn-outline-primary btn-sm mt-2">Ask a Doubt</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Modals -->

    <!-- Generate Quiz Modal -->
    <div class="modal fade" id="generateQuizModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0 bg-warning bg-opacity-10">
                    <h5 class="modal-title fw-bold text-dark d-flex align-items-center">
                        <span class="material-icons me-2 text-warning">psychology</span> AI Quiz Generator
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div id="generate-quiz-form-container">
                        <div class="row g-3">
                            <div class="col-md-5">
                                <label class="form-label fw-bold">Topic</label>
                                <input type="text" class="form-control" id="quiz-topic"
                                    placeholder="e.g. Photosynthesis">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label fw-bold">Questions</label>
                                <input type="number" class="form-control" id="quiz-count" value="5" min="1" max="10">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label fw-bold">Difficulty</label>
                                <select class="form-select" id="quiz-difficulty">
                                    <option value="Easy">Easy</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="Hard">Hard</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold">Type</label>
                                <select class="form-select" id="quiz-type">
                                    <option value="Multiple Choice">Multiple Choice</option>
                                    <option value="True/False">True/False</option>
                                    <option value="Short Answer">Short Answer</option>
                                </select>
                            </div>
                            <!-- Added Description Field -->
                            <div class="col-12">
                                <label class="form-label fw-bold">Additional Context / Description</label>
                                <textarea id="quiz-description" class="form-control" rows="2"
                                    placeholder="e.g. Focus on European countries, emphasize dates..."></textarea>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold">Upload PDF Context (Optional)</label>
                                <input type="file" class="form-control" id="quiz-pdf" accept=".pdf">
                            </div>
                            <div class="col-12 mt-4">
                                <button type="button" class="btn btn-warning w-100 fw-bold shadow-sm"
                                    style="z-index: 1050;" onclick="handleGenerateQuiz(event)">
                                     Generate Quiz
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Results Area -->
                    <div id="quiz-result-container" class="mt-4 d-none">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="fw-bold text-muted text-uppercase small mb-0">Preview</h6>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="toggle-quiz-answers"
                                    onchange="toggleQuizAnswers()">
                                <label class="form-check-label small" for="toggle-quiz-answers">Show Answers</label>
                            </div>
                        </div>

                        <!-- Rich Preview Area -->
                        <div id="quiz-preview-content" class="bg-light p-3 rounded border mb-3"
                            style="max-height: 300px; overflow-y: auto;">
                            <!-- Questions injected here -->
                        </div>

                        <!-- Save Controls -->
                        <div id="quiz-save-area" class="border-top pt-3">
                            <label class="form-label fw-bold">Save to Course:</label>
                            <div class="input-group">
                                <select id="save-quiz-group-select" class="form-select"></select>
                                <button class="btn btn-success fw-bold" onclick="saveGeneratedQuiz()">
                                    <span class="material-icons align-middle fs-6 me-1">save</span> Save Quiz
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div class="modal fade" id="addStudentModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold text-primary-custom"> Add New Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-5 pb-5">
                    <p id="add-student-message" class="text-primary fw-medium"></p>
                    <form id="add-student-form" class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Student ID</label>
                            <input type="text" class="form-control" id="new-id" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Full Name</label>
                            <input type="text" class="form-control" id="new-name" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-bold">Default Password</label>
                            <input type="text" class="form-control" id="new-password" value="123" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Grade</label>
                            <input type="number" class="form-control" id="new-grade" min="1" max="12" value="9"
                                required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Preferred Subject</label>
                            <select class="form-select" id="new-subject" required>
                                <option value="Science">Science</option>
                                <option value="Maths">Maths</option>
                                <option value="Social">Social</option>
                                <option value="English">English</option>
                                <option value="Tamil">Tamil</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Home Language</label>
                            <input type="text" class="form-control" id="new-lang" value="English" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-bold">Attendance Rate (%)</label>
                            <input type="number" class="form-control" id="new-attendance" min="0" max="100" step="0.1"
                                value="90.0" required>
                        </div>

                        <div class="col-12 mt-4">
                            <h6 class="border-bottom pb-2">Initial Assessment Scores (%)</h6>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Math Score</label>
                            <input type="number" class="form-control" id="new-math-score" min="0" max="100" step="0.1"
                                value="75.0" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Science Score</label>
                            <input type="number" class="form-control" id="new-science-score" min="0" max="100"
                                step="0.1" value="75.0" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">English Score</label>
                            <input type="number" class="form-control" id="new-english-score" min="0" max="100"
                                step="0.1" value="75.0" required>
                        </div>

                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-primary-custom w-100 py-2">Add Student to
                                Roster</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Access Card Modal (For Printing) -->
    <div class="modal fade" id="accessCardModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header bg-dark text-white border-bottom-0">
                    <h5 class="modal-title fw-bold d-flex align-items-center gap-2">
                        <span class="material-icons">badge</span> Student Access Card
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4 text-center bg-light">
                    <div id="access-card-content" class="bg-white p-4 rounded-3 shadow-sm border border-2">
                        <div class="mb-3">
                            <span class="material-icons text-primary-custom" style="font-size: 48px;">school</span>
                        </div>
                        <h4 class="fw-bold m-0" id="card-student-name">Student Name</h4>
                        <p class="text-muted small mb-3">ID: <span id="card-student-id">S000</span></p>

                        <hr>

                        <h6 class="text-uppercase text-secondary fw-bold small mb-3">Pre-generated Lifetime Codes</h6>
                        <div id="card-codes-list" class="d-flex flex-wrap justify-content-center gap-2">
                            <!-- Codes injected here -->
                        </div>

                        <div class="mt-4 alert alert-warning small py-1">
                            <i class="material-icons opacity-50 align-middle" style="font-size:16px">info</i>
                            Keep this card safe. Required for login.
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-top-0 justify-content-center">
                    <button type="button" class="btn btn-outline-danger d-flex align-items-center gap-2 me-auto"
                        onclick="regenerateAccessCode()">
                        <span class="material-icons">refresh</span> Regenerate
                    </button>
                    <button type="button" class="btn btn-outline-dark d-flex align-items-center gap-2"
                        onclick="window.print()">
                        <span class="material-icons">print</span> Print Card
                    </button>
                    <button type="button" class="btn btn-primary-custom" data-bs-dismiss="modal">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Moodle LMS Integration View -->
    <div id="moodle-view" class="view container-fluid p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h3 class="fw-bold text-dark m-0">Moodle Learning Management System</h3>
                <p class="text-muted small m-0">Seamlessly access your courses and assignments</p>
            </div>
            <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#moodleSettingsModal">
                <span class="material-icons align-middle me-1">settings</span> Configure
            </button>
        </div>

        <div class="row justify-content-center mt-5">
            <div class="col-md-8 col-lg-6">
                <div class="card border-0 shadow-sm rounded-4 text-center p-5">
                    <div class="mb-4">
                        <img src="https://moodle.org/theme/moodleorg/pix/moodle_logo_TM.svg" alt="Moodle Logo"
                            style="height: 60px;">
                    </div>
                    <h4 class="fw-bold mb-3">Welcome to Moodle LMS</h4>
                    <p class="text-muted mb-4">
                        Click the button below to launch Moodle. You will be automatically logged in ensuring a seamless
                        learning experience.
                    </p>

                    <button class="btn btn-warning btn-lg px-5 py-3 rounded-pill fw-bold shadow-sm"
                        onclick="launchMoodleSSO()">
                        <span class="material-icons align-middle me-2">open_in_new</span> Launch Moodle
                    </button>

                    <div class="mt-4 pt-4 border-top">
                        <small class="text-muted d-block mb-2">Features enabled:</small>
                        <div class="d-flex justify-content-center gap-3">
                            <span class="badge bg-light text-dark border"><i
                                    class="material-icons fs-6 align-middle me-1">vpn_key</i> Single Sign-On</span>
                            <span class="badge bg-light text-dark border"><i
                                    class="material-icons fs-6 align-middle me-1">sync</i> Auto-Sync</span>
                            <span class="badge bg-light text-dark border"><i
                                    class="material-icons fs-6 align-middle me-1">security</i> Secure Access</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Moodle Settings Modal -->
    <div class="modal fade" id="moodleSettingsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold"> Moodle Configuration</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <p class="text-muted small">Enter the URL of your Moodle instance. This will link the "Launch
                        Moodle" button directly to your learning platform.</p>
                    <form id="moodle-settings-form">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Moodle Site URL</label>
                            <input type="url" id="moodle-url-input" class="form-control"
                                placeholder="https://moodle.yourschool.edu" required>
                            <div class="form-text">Must start with http:// or https://</div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary-custom">Save Configuration</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Access Card Modal (For Printing) -->
    <div class="modal fade" id="accessCardModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header bg-dark text-white border-bottom-0">
                    <h5 class="modal-title fw-bold d-flex align-items-center gap-2">
                        <span class="material-icons">badge</span> Student Access Card
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4 text-center bg-light">
                    <div id="access-card-content" class="bg-white p-4 rounded-3 shadow-sm border border-2">
                        <div class="mb-3">
                            <span class="material-icons text-primary-custom" style="font-size: 48px;">school</span>
                        </div>
                        <h4 class="fw-bold m-0" id="card-student-name">Student Name</h4>
                        <p class="text-muted small mb-3">ID: <span id="card-student-id">S000</span></p>

                        <hr>

                        <h6 class="text-uppercase text-secondary fw-bold small mb-3">Pre-generated One-Time Codes</h6>
                        <div id="card-codes-list" class="d-flex flex-wrap justify-content-center gap-2">
                            <!-- Codes injected here -->
                        </div>

                        <div class="mt-4 alert alert-warning small py-1">
                            <i class="material-icons opacity-50 align-middle" style="font-size:16px">info</i>
                            Keep this card safe. Required for login.
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-top-0 justify-content-center">
                    <button type="button" class="btn btn-outline-danger d-flex align-items-center gap-2 me-auto"
                        onclick="regenerateAccessCode()">
                        <span class="material-icons">refresh</span> Regenerate
                    </button>
                    <button id="btn-email-card" type="button"
                        class="btn btn-outline-primary d-flex align-items-center gap-2" onclick="sendAccessCardEmail()">
                        <span class="material-icons">email</span> Email Me
                    </button>
                    <button type="button" class="btn btn-outline-dark d-flex align-items-center gap-2"
                        onclick="window.print()">
                        <span class="material-icons">print</span> Print Card
                    </button>
                    <button type="button" class="btn btn-primary-custom" data-bs-dismiss="modal">Done</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Edit Student Modal (Revamped) -->
    <div class="modal fade" id="editStudentModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
                <div class="modal-header bg-gradient-primary-to-secondary text-white border-bottom-0 p-4"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div>
                        <h5 class="modal-title fw-bold d-flex align-items-center gap-2">
                            <span class="material-icons">edit_note</span> Edit Student Profile
                        </h5>
                        <p class="mb-0 small opacity-75">Update student details and performance metrics</p>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        id="close-edit-modal"></button>
                </div>

                <div class="modal-body p-0">
                    <p id="edit-student-message" class="text-center fw-medium p-2 mb-0 bg-light border-bottom d-none">
                    </p>

                    <form id="edit-student-form">
                        <input type="hidden" id="edit-id">

                        <!-- Tabs -->
                        <ul class="nav nav-tabs nav-fill bg-light px-3 pt-3 border-bottom-0" id="editStudentTabs"
                            role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active fw-bold py-3" id="edit-profile-tab" data-bs-toggle="tab"
                                    data-bs-target="#edit-profile" type="button" role="tab" aria-selected="true">
                                    <span class="material-icons align-middle fs-5 me-1">person</span> Profile
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link fw-bold py-3" id="edit-academic-tab" data-bs-toggle="tab"
                                    data-bs-target="#edit-academic" type="button" role="tab" aria-selected="false">
                                    <span class="material-icons align-middle fs-5 me-1">school</span> Academic
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content p-4" id="editStudentTabContent">

                            <div class="tab-pane fade show active" id="edit-profile" role="tabpanel">
                                <div class="alert alert-light border d-flex align-items-center gap-3 mb-4">
                                    <div class="bg-primary-subtle rounded-circle p-3 text-primary">
                                        <span class="material-icons fs-3">badge</span>
                                    </div>
                                    <div>
                                        <small class="text-uppercase text-muted fw-bold">Student ID</small>
                                        <h5 class="mb-0 fw-bold" id="edit-id-display">--</h5>
                                    </div>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="edit-name" placeholder="Full Name"
                                        required>
                                    <label for="edit-name">Full Name</label>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="edit-password"
                                        placeholder="New Password (Optional)">
                                    <label for="edit-password">New Password (Optional)</label>
                                </div>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="edit-lang"
                                                placeholder="Home Language" required>
                                            <label for="edit-lang">Home Language</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="edit-attendance" min="0"
                                                max="100" step="0.1" required>
                                            <label for="edit-attendance">Attendance (%)</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab 2: Academic & Scores -->
                            <div class="tab-pane fade" id="edit-academic" role="tabpanel">
                                <div class="row g-3 mb-4">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-muted small text-uppercase">Current
                                            Grade</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-white"><span
                                                    class="material-icons fs-5 text-muted">grade</span></span>
                                            <input type="number" class="form-control" id="edit-grade" min="1" max="12"
                                                required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-muted small text-uppercase">Preferred
                                            Subject</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-white"><span
                                                    class="material-icons fs-5 text-muted">auto_stories</span></span>
                                            <select class="form-select" id="edit-subject" required>
                                                <option value="Science">Science</option>
                                                <option value="Maths">Maths</option>
                                                <option value="Social">Social</option>
                                                <option value="English">English</option>
                                                <option value="Tamil">Tamil</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <h6 class="fw-bold border-bottom pb-2 mb-3 text-primary-custom">
                                    <span class="material-icons align-middle fs-6 me-1">analytics</span> Initial
                                    Assessment Scores
                                </h6>

                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Math Score</span>
                                        <span class="fw-bold text-primary" id="lbl-math">0%</span>
                                    </label>
                                    <input type="range" class="form-range" id="rng-math" min="0" max="100" step="0.5"
                                        oninput="document.getElementById('edit-math-score').value=this.value; document.getElementById('lbl-math').textContent=this.value+'%'">
                                    <input type="number" class="form-control" id="edit-math-score" min="0" max="100"
                                        step="0.1" required
                                        oninput="document.getElementById('rng-math').value=this.value; document.getElementById('lbl-math').textContent=this.value+'%'">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Science Score</span>
                                        <span class="fw-bold text-primary" id="lbl-science">0%</span>
                                    </label>
                                    <input type="range" class="form-range" id="rng-science" min="0" max="100" step="0.5"
                                        oninput="document.getElementById('edit-science-score').value=this.value; document.getElementById('lbl-science').textContent=this.value+'%'">
                                    <input type="number" class="form-control" id="edit-science-score" min="0" max="100"
                                        step="0.1" required
                                        oninput="document.getElementById('rng-science').value=this.value; document.getElementById('lbl-science').textContent=this.value+'%'">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>English Score</span>
                                        <span class="fw-bold text-primary" id="lbl-english">0%</span>
                                    </label>
                                    <input type="range" class="form-range" id="rng-english" min="0" max="100" step="0.5"
                                        oninput="document.getElementById('edit-english-score').value=this.value; document.getElementById('lbl-english').textContent=this.value+'%'">
                                    <input type="number" class="form-control" id="edit-english-score" min="0" max="100"
                                        step="0.1" required
                                        oninput="document.getElementById('rng-english').value=this.value; document.getElementById('lbl-english').textContent=this.value+'%'">
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer border-top-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-outline-secondary px-4"
                                data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary-custom px-4 fw-bold"
                                onclick="submitEditStudentForm()">
                                <span class="material-icons align-middle fs-5 me-1">save</span> Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"> Delete Student</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="delete-modal-text" class="fw-bold">Are you sure?</p>
                    <p class="small text-muted mb-0">This action cannot be undone. All student data and activity history
                        will be erased permenantly.</p>
                    <div id="delete-error-msg" class="text-danger mt-2 fw-bold small"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">Permanently Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div class="modal fade" id="createGroupModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold text-primary-custom"> Create New Course</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-4 pb-4">
                    <p id="create-group-message" class="text-primary fw-medium"></p>
                    <form id="create-group-form">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Course Name</label>
                            <input type="text" class="form-control" id="group-name" required
                                placeholder="e.g. Algebra 101">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Subject</label>
                            <select class="form-select" id="group-subject">
                                <option value="General">General</option>
                                <option value="Science">Science</option>
                                <option value="Maths">Maths</option>
                                <option value="Social">Social</option>
                                <option value="English">English</option>
                                <option value="Tamil">Tamil</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Description</label>
                            <textarea class="form-control" id="group-desc" rows="2"
                                placeholder="Optional description"></textarea>
                            <div class="form-text text-muted small"><i class="material-icons align-middle"
                                    style="font-size: 14px;">info</i> You can upload videos and PDFs after creating the
                                course.</div>
                        </div>
                        <button type="submit" class="btn btn-primary-custom w-100">Create Course</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Group Modal (Members & Materials) -->
    <div class="modal fade" id="manageMembersModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold text-primary-custom" id="manage-group-title"> Manage Course</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-4 pb-4">
                    <h6 id="manage-group-name" class="fw-bold mb-3 d-none"></h6>
                    <input type="hidden" id="manage-group-id">

                    <!-- Tabs -->
                    <ul class="nav nav-tabs mb-3" id="manageGroupTabs" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active" id="tab-members-btn" data-bs-toggle="tab"
                                data-bs-target="#tab-members" type="button">Members</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" id="tab-materials-btn" data-bs-toggle="tab"
                                data-bs-target="#tab-materials" type="button">Materials & Resources</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="manageGroupTabContent">
                        <!-- Members Tab -->
                        <div class="tab-pane fade show active" id="tab-members" role="tabpanel">
                            <div class="border rounded p-2 mb-3" style="max-height: 250px; overflow-y: auto;">
                                <div id="group-members-list">Loading...</div>
                            </div>
                            <div class="d-flex justify-content-end gap-2">
                                <button type="button" class="btn btn-outline-danger" onclick="deleteGroup()">Delete
                                    Course</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveGroupMembers()">Save
                                    Members</button>
                            </div>
                        </div>

                        <!-- Materials Tab -->
                        <div class="tab-pane fade" id="tab-materials" role="tabpanel">
                            <!-- Add Material Form -->
                            <div class="card bg-light border-0 mb-3">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-2">Post New Material</h6>
                                    <form id="add-material-form" onsubmit="handlePostMaterial(event)">
                                        <div class="row g-2">
                                            <div class="col-md-8">
                                                <input type="text" class="form-control form-control-sm" id="mat-title"
                                                    placeholder="Title (e.g. Chapter 1 Notes)" required>
                                            </div>
                                            <div class="col-md-4">
                                                <select class="form-select form-select-sm" id="mat-type"
                                                    onchange="toggleMaterialInput()">
                                                    <option value="Note">Note / Text</option>
                                                    <option value="Quiz">Quiz Link</option>
                                                    <option value="Video">Video Link</option>
                                                    <option value="File">File Upload (PDF/Video)</option>
                                                </select>
                                            </div>
                                            <div class="col-12" id="mat-text-input-group">
                                                <input type="text" class="form-control form-control-sm" id="mat-content"
                                                    placeholder="Content or URL..." required>
                                            </div>
                                            <div class="col-12 d-none" id="mat-file-input-group">
                                                <input type="file" class="form-control form-control-sm" id="mat-file"
                                                    accept=".pdf, .mp4, .mov, .jpg, .png">
                                            </div>
                                            <div class="col-12 text-end">
                                                <button type="submit" class="btn btn-sm btn-primary-custom"
                                                    id="post-material-btn">Post</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Materials List -->
                            <h6 class="fw-bold">Posted Resources</h6>
                            <div id="group-materials-list" class="list-group list-group-flush"
                                style="max-height: 200px; overflow-y: auto;">
                                <!-- Items injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Activity Modal -->
    <div class="modal fade" id="addActivityModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold text-primary-custom"> Log New Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" id="close-activity-modal"></button>
                </div>
                <div class="modal-body px-4 pb-4">
                    <p id="add-activity-message" class="text-primary fw-medium"></p>
                    <form id="add-activity-form" class="row g-3">
                        <div class="col-12">
                            <label class="form-label fw-bold">Select Student</label>
                            <select class="form-select" id="activity-student-select" required></select>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-bold">Date</label>
                            <input type="date" class="form-control" id="activity-date" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-bold">Topic</label>
                            <input type="text" class="form-control" id="activity-topic"
                                placeholder="e.g., Quadratic Equations" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Difficulty</label>
                            <select class="form-select" id="activity-difficulty" required>
                                <option value="Easy">Easy</option>
                                <option value="Medium">Medium</option>
                                <option value="Hard">Hard</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Score (%)</label>
                            <input type="number" class="form-control" id="activity-score" min="0" max="100" step="0.1"
                                value="85.0" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Time (min)</label>
                            <input type="number" class="form-control" id="activity-time" min="1" value="30" required>
                        </div>
                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-primary-custom w-100 py-2">Log Activity</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Class Modal -->
    <div class="modal fade" id="scheduleClassModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold text-primary-custom"> Schedule Live Class</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" id="close-schedule-modal"></button>
                </div>
                <div class="modal-body px-4 pb-4">
                    <p id="schedule-message" class="text-primary fw-medium"></p>
                    <form id="schedule-class-form" class="row g-3">
                        <div class="col-12">
                            <label class="form-label fw-bold">Topic / Subject</label>
                            <input type="text" class="form-control" id="class-topic"
                                placeholder="e.g., Math Doubt Session" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-bold">Date & Time</label>
                            <input type="datetime-local" class="form-control" id="class-date" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-bold">Target Students</label>

                            <!-- Group Filter -->
                            <div class="input-group mb-2">
                                <label class="input-group-text bg-white small">Filter by Group</label>
                                <select class="form-select" id="schedule-group-filter"
                                    onchange="applyGroupFilter(this.value)">
                                    <option value="">-- All Students --</option>
                                    <!-- Options injected via JS -->
                                </select>
                            </div>

                            <div class="border rounded p-2"
                                style="max-height: 120px; overflow-y: auto; background: #f8f9fa;">
                                <div class="form-check mb-2 pb-2 border-bottom">
                                    <input class="form-check-input" type="checkbox" id="select-all-students"
                                        onchange="toggleStudentCheckboxes(this)">
                                    <label class="form-check-label fw-bold" for="select-all-students">Select All</label>
                                </div>
                                <div id="schedule-student-list">
                                    <!-- Checkboxes -->
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-bold">Google Meet Link</label>
                            <input type="url" class="form-control" id="class-link"
                                placeholder="https://meet.google.com/..." required>
                            <div class="form-text">Copy paste a link from <a href="https://meet.google.com/"
                                    target="_blank">Google Meet</a>.</div>
                        </div>
                        <div class="col-12 mt-4">
                            <button type="submit" class="btn text-white w-100 py-2"
                                style="background-color: #673ab7;">Schedule Class</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Group Content Modal -->
    <div class="modal fade" id="studentGroupModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <div>
                        <h5 class="modal-title fw-bold text-primary-custom" id="sg-title">Group Name</h5>
                        <p class="mb-0 text-muted small" id="sg-desc">Group Description</p>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-4 pb-4">
                    <h6 class="fw-bold border-bottom pb-2 mb-3"> Class Materials & Resources</h6>
                    <div id="student-materials-list" class="list-group list-group-flush">
                        <!-- Materials injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- About Portal Modal (Revamped) -->
    <div class="modal fade" id="aboutPortalModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
                <!-- Header with Gradient -->
                <div class="modal-header border-bottom-0 text-white p-5 position-relative"
                    style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);">
                    <div class="position-relative z-1">
                        <h2 class="fw-bold mb-2 d-flex align-items-center gap-3">
                            <span class="bg-white text-primary rounded-circle p-2 d-flex"><span
                                    class="material-icons">school</span></span>
                            Noble Nexus Portal
                        </h2>
                        <p class="lead mb-0 opacity-75">Empowering the next generation of learners with AI.</p>
                    </div>
                    <!-- Decorative Circle -->
                    <div class="position-absolute top-0 end-0 rounded-circle bg-white opacity-10"
                        style="width: 200px; height: 200px; transform: translate(30%, -30%);"></div>
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-4"
                        data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body p-5">
                    <div class="row g-4">
                        <!-- Feature 1 -->
                        <div class="col-md-4">
                            <div class="p-4 rounded-4 h-100 text-center hover-up transition-all"
                                style="background: #f3f4f6;">
                                <div class="mb-3 text-primary">
                                    <span class="material-icons" style="font-size: 48px;">insights</span>
                                </div>
                                <h5 class="fw-bold mb-2">Smart Analytics</h5>
                                <p class="text-muted small mb-0">Deep insights into student performance using advanced
                                    machine learning models.</p>
                            </div>
                        </div>

                        <!-- Feature 2 -->
                        <div class="col-md-4">
                            <div class="p-4 rounded-4 h-100 text-center hover-up transition-all"
                                style="background: #f3f4f6;">
                                <div class="mb-3 text-danger">
                                    <span class="material-icons" style="font-size: 48px;">videocam</span>
                                </div>
                                <h5 class="fw-bold mb-2">Live Classrooms</h5>
                                <p class="text-muted small mb-0">Seamlessly schedule and join Google Meet sessions
                                    directly from the dashboard.</p>
                            </div>
                        </div>

                        <!-- Feature 3 -->
                        <div class="col-md-4">
                            <div class="p-4 rounded-4 h-100 text-center hover-up transition-all"
                                style="background: #f3f4f6;">
                                <div class="mb-3 text-success">
                                    <span class="material-icons" style="font-size: 48px;">auto_awesome</span>
                                </div>
                                <h5 class="fw-bold mb-2">AI Guidance</h5>
                                <p class="text-muted small mb-0">Personalized recommendations and study paths tailored
                                    to each student.</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-5 text-center border-top pt-4">
                        <p class="text-muted small mb-3">Version 2.0.0  Built for Excellence</p>
                        <button class="btn btn-outline-primary px-4 rounded-pill fw-bold" data-bs-dismiss="modal">Close
                            Overview</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title fw-bold text-primary-custom">Reset Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-5 pb-5">
                    <p class="text-muted small mb-4">Enter your email address and we'll send you a link to reset your
                        password.</p>
                    <form id="forgot-password-form">
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="reset-email" placeholder="Email" required>
                            <label for="reset-email">Email Address</label>
                        </div>
                        <p id="reset-message" class="text-center fw-medium small mb-2"></p>
                        <button type="submit" class="btn btn-primary-custom w-100 py-2">Send Reset Link</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password Modal (New Password Entry) -->
    <div class="modal fade" id="resetPasswordModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header border-bottom-0 bg-primary-custom text-white">
                    <h5 class="modal-title fw-bold"> Set New Password</h5>
                </div>
                <div class="modal-body px-5 py-5">
                    <p class="text-center text-muted mb-4">Please enter your new password below.</p>
                    <form id="reset-password-form">
                        <input type="hidden" id="reset-token">
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="new-reset-pass" placeholder="New Password"
                                required oninput="checkPasswordStrength(this.value)">
                            <label for="new-reset-pass">New Password</label>
                        </div>

                        <p id="new-reset-message" class="text-center fw-medium small mb-2"></p>
                        <button type="submit" class="btn btn-primary-custom w-100 py-2 fw-bold">Update Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Audit Log Modal -->
    <div class="modal fade" id="auditLogModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title d-flex align-items-center gap-2">
                        <span class="material-icons text-danger">security</span> Security Audit Logs
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <table class="table table-striped table-hover mb-0 font-monospace small">
                        <thead class="table-light sticky-top">
                            <tr>
                                <th>Time</th>
                                <th>User ID</th>
                                <th>Event</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="audit-log-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Whiteboard Modal -->
    <div class="modal fade" id="whiteboardModal" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white p-2">
                    <h5 class="modal-title fs-6"><span class="material-icons align-middle fs-5 me-2">gesture</span> Live
                        Whiteboard</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0 position-relative"
                    style="background-color: #f0f0f0; overflow: hidden; touch-action: none;">
                    <canvas id="whiteboard-canvas"
                        style="cursor: crosshair; touch-action: none; display: block;"></canvas>

                    <!-- Floating Toolbar -->
                    <div class="position-absolute top-0 start-50 translate-middle-x mt-3 bg-white shadow-sm p-2 rounded-pill d-flex gap-2 align-items-center"
                        style="z-index: 1060;">
                        <input type="color" id="wb-color" class="form-control form-control-color border-0 p-1"
                            value="#000000" title="Color" style="width: 40px; height: 35px;">
                        <input type="range" id="wb-width" class="form-range w-auto" min="1" max="20" value="2"
                            title="Brush Size" style="width: 100px;">
                        <div class="vr mx-1"></div>
                        <button class="btn btn-sm btn-outline-danger d-flex align-items-center gap-1"
                            onclick="clearWhiteboard()">
                            <span class="material-icons fs-6">delete</span> Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <script src="./static/grid_plasma.js"></script>
    <script src="./static/shader_background_webgl.js"></script>
    <script src="./static/glowing_cards.js"></script>
    <script src="./static/testimonial_cards.js"></script>
    <script src="script.js"></script>
    <!-- Create Assignment Modal -->
    <div class="modal fade" id="createAssignmentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold"> New Assignment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="create-assignment-form">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Title</label>
                            <input type="text" id="asg-title" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Description</label>
                            <textarea id="asg-desc" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">Type</label>
                                <select id="asg-type" class="form-select">
                                    <option value="Assignment">Assignment</option>
                                    <option value="Project">Project</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Points</label>
                                <input type="number" id="asg-points" class="form-control" value="100">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Due Date</label>
                            <input type="date" id="asg-date" class="form-control" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary-custom fw-bold w-100"
                        onclick="handleCreateAssignment()">Create</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Assignment Modal -->
    <div class="modal fade" id="submitAssignmentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title fw-bold"> Submit Assignment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <input type="hidden" id="submit-asg-id">
                    <h6 id="submit-asg-title" class="fw-bold mb-3">Assignment Title</h6>
                    <div class="mb-3">
                        <label class="form-label">Your Submission (Text or Link)</label>
                        <textarea id="submit-content" class="form-control" rows="4"
                            placeholder="Type your answer or paste a Google Doc link here..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success fw-bold w-100"
                        onclick="handleSubmitAssignment()">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Submissions Modal (Teacher) -->
    <div class="modal fade" id="viewSubmissionsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title fw-bold"> Student Submissions</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <ul id="submissions-list" class="list-group list-group-flush">
                        <!-- Submissions injected here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- USER MANAGEMENT VIEW -->
    <div id="user-management-view" class="view" style="padding-left: 280px; padding-top: 30px; display: none;">
        <div class="container-fluid px-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 fw-bold text-dark mb-0">User Management</h1>
                <button class="btn btn-primary-custom" onclick="openAddUserModal()">
                    <span class="material-icons align-middle fs-5 me-1">add</span> Add New User
                </button>
            </div>

            <!-- Tabs -->
            <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active fw-bold" id="pills-users-tab" data-bs-toggle="pill"
                        data-bs-target="#pills-users" type="button" onclick="loadUserList()">
                        <span class="material-icons align-middle fs-6 me-1">people</span> All Users
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link fw-bold" id="pills-audit-tab" data-bs-toggle="pill"
                        data-bs-target="#pills-audit" type="button" onclick="showAuditLogs()">
                        <span class="material-icons align-middle fs-6 me-1">history</span> Audit Logs
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="pills-tabContent">
                <!-- User List Tab -->
                <div class="tab-pane fade show active" id="pills-users" role="tabpanel">
                    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0" id="users-table">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="py-3 ps-4">Name</th>
                                            <th class="py-3">Role</th>
                                            <th class="py-3">Email/ID</th>
                                            <th class="py-3">Grade/Subject</th>
                                            <!-- <th class="py-3 text-end pe-4">Actions</th> -->
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body">
                                        <tr>
                                            <td colspan="5" class="text-center py-5">
                                                <div class="spinner-border text-primary"></div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audit Logs Tab -->
                <div class="tab-pane fade" id="pills-audit" role="tabpanel">
                    <div id="audit-logs-container" class="bg-white p-3 rounded-4 shadow-sm">
                        <p class="text-center text-muted">Loading logs...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD USER VIEW -->
    <div id="add-user-view" class="view" style="padding-left: 280px; padding-top: 30px; display: none;">
        <div class="container-fluid px-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-light rounded-circle shadow-sm" onclick="switchView('user-management-view')">
                        <span class="material-icons text-dark">arrow_back</span>
                    </button>
                    <h1 class="h3 fw-bold text-dark mb-0">Create New User</h1>
                </div>
            </div>

            <div class="card border-0 shadow-sm rounded-4 p-4" style="max-width: 800px; margin: 0 auto;">
                <form id="add-user-form" onsubmit="handleCreateUser(event)">
                    <div class="form-floating mb-3">
                        <input type="text" id="new-user-name" class="form-control bg-light border-0"
                            placeholder="Full Name" required>
                        <label>Full Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" id="new-user-id" class="form-control bg-light border-0"
                            placeholder="Email or Unique ID" required>
                        <label>Email or Unique ID</label>
                    </div>
                    <div class="form-floating mb-3">
                        <select id="new-user-role" class="form-select bg-light border-0" required
                            onchange="toggleUserFields()">
                            <option value="Student">Student</option>
                            <option value="Teacher">Teacher</option>
                            <option value="Parent_Guardian">Parent / Guardian</option>
                            <option value="Tenant_Admin">Tenant Admin (Principal)</option>
                            <option value="Academic_Admin">Academic Admin</option>
                            <option value="Finance_Officer">Finance Officer</option>
                            <option value="HR_Admin">HR Admin</option>
                            <option value="Root_Super_Admin">Root Super Admin</option>
                        </select>
                        <label>Role</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" id="new-user-password" class="form-control bg-light border-0"
                            placeholder="Password" required>
                        <label>Password</label>
                        <small class="text-muted">Must be at least 8 chars, incl. number & special char.</small>
                    </div>

                    <!-- Conditional Fields -->
                    <div id="student-fields">
                        <div class="form-floating mb-3">
                            <select id="new-user-grade" class="form-select bg-light border-0">
                                <option value="9">Grade 9</option>
                                <option value="10">Grade 10</option>
                                <option value="11">Grade 11</option>
                                <option value="12">Grade 12</option>
                            </select>
                            <label>Grade</label>
                        </div>
                    </div>
                    <div id="teacher-fields" style="display:none;">
                        <div class="form-floating mb-3">
                            <input type="text" id="new-user-subject" class="form-control bg-light border-0"
                                placeholder="Science">
                            <label>Preferred/Teaching Subject</label>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <button type="button" class="btn btn-light"
                            onclick="switchView('user-management-view')">Cancel</button>
                        <button type="submit" class="btn btn-primary-custom px-5 rounded-pill fw-bold">Create
                            User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ADD USER MODAL -->


    <!-- Add Video Modal -->
    <div class="modal fade" id="addVideoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title fw-bold"> Add Course Video</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="add-video-form">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Video Title</label>
                            <input type="text" id="video-title" class="form-control"
                                placeholder="e.g. Introduction to Algebra" required>
                        </div>
                        <div class="mb-3">
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-danger text-white fw-bold w-100">Add Video</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Announcement Modal -->
    <div class="modal fade" id="createAnnouncementModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold"> New Announcement</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="create-announcement-form" onsubmit="handleCreateAnnouncement(event)">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Title</label>
                            <input type="text" id="ann-title" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Content</label>
                            <textarea id="ann-content" class="form-control" rows="4" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Target Audience</label>
                            <select id="ann-target" class="form-select">
                                <option value="All">All Users</option>
                                <option value="Parent">Parents Only</option>
                                <option value="Student">Students Only</option>
                                <option value="Teacher">Staff Only</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 fw-bold">Post Announcement</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Compose Message Modal -->
    <div class="modal fade" id="composeMessageModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title fw-bold"> Compose Message</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="compose-message-form" onsubmit="handleSendMessage(event)">
                        <div class="mb-3">
                            <label class="form-label fw-bold">To (User ID)</label>
                            <!-- Simple text input for now, ideally a search/dropdown -->
                            <input type="text" id="msg-receiver" class="form-control" placeholder="Enter User ID"
                                required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Subject</label>
                            <input type="text" id="msg-subject" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Message</label>
                            <textarea id="msg-content" class="form-control" rows="4" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success w-100 fw-bold">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title fw-bold"> Add Calendar Event</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="add-event-form" onsubmit="handleCreateEvent(event)">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Event Title</label>
                            <input type="text" id="evt-title" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Date</label>
                            <input type="date" id="evt-date" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Type</label>
                            <select id="evt-type" class="form-select">
                                <option value="Meeting">Meeting</option>
                                <option value="Exam">Exam</option>
                                <option value="Holiday">Holiday</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-info text-white w-100 fw-bold">Add Event</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Glassmorphism Scroll Effect
        document.addEventListener('DOMContentLoaded', () => {
            const landingView = document.getElementById('landing-view');
            const navbar = document.getElementById('landing-navbar'); // We added this ID

            if (landingView && navbar) {
                landingView.addEventListener('scroll', () => {
                    if (landingView.scrollTop > 50) {
                        navbar.classList.add('scrolled-mode');
                    } else {
                        navbar.classList.remove('scrolled-mode');
                    }
                });
            }
        });
    </script>

    <!-- SIDEBAR CHATBOT COMPONENT (NEW) -->
    <div id="ai-chat-toggle" class="chat-toggle-btn" onclick="toggleSidebarChat()" style="display: none;">
        <span class="material-icons fs-2">smart_toy</span>
    </div>

    <div id="ai-sidebar">
        <!-- Header -->
        <div class="chat-header">
            <div class="d-flex align-items-center gap-3">
                <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center"
                    style="width: 40px; height: 40px;">
                    <span class="material-icons">school</span>
                </div>
                <div>
                    <h5 class="mb-0 fw-bold text-dark">Education Assistant</h5>
                    <small class="text-muted d-flex align-items-center gap-1">
                        <span class="d-inline-block rounded-circle bg-success" style="width: 8px; height: 8px;"></span>
                        Online
                    </small>
                </div>
            </div>
            <button class="btn btn-link text-secondary p-0" onclick="toggleSidebarChat()">
                <span class="material-icons">close</span>
            </button>
        </div>

        <!-- Chat Body -->
        <div id="sidebar-chat-body" class="chat-body">
            <!-- Welcome Message -->
            <div class="chat-message ai">
                <p>Hello!  I'm your Education & Data Assistant.</p>
                <p>I can help you with:</p>
                <ul>
                    <li>Explaining concepts (Photosynthesis, Algebra, etc.)</li>
                    <li>Querying data (Show student scores, attendance, etc.)</li>
                </ul>
                <p>How can I help you today?</p>
            </div>
        </div>

        <!-- Input Area -->
        <div class="chat-input-area">
            <div class="d-flex flex-column gap-2">
                <textarea id="sidebar-chat-input" class="form-control border-0 bg-light" rows="2"
                    placeholder="Ask a question..." style="resize: none; border-radius: 12px; padding: 12px;"
                    onkeydown="handleSidebarEnter(event)"></textarea>

                <!-- File Preview/Indicator -->
                <div id="chat-file-preview" class="small text-primary px-2" style="display: none;">
                    <span class="material-icons fs-6 align-middle">description</span>
                    <span id="chat-file-name" class="fw-bold">filename.pdf</span>
                    <span class="material-icons fs-6 align-middle text-danger cursor-pointer"
                        onclick="clearChatFile()">close</span>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex gap-2">
                        <!-- Hidden File Input -->
                        <input type="file" id="chat-file-input" style="display: none;"
                            onchange="handleChatFileSelect(this)">

                        <!-- Attachment Icon -->
                        <button class="btn btn-sm btn-link text-muted p-0"
                            onclick="document.getElementById('chat-file-input').click()" title="Attach File">
                            <span class="material-icons">attach_file</span>
                        </button>

                        <button class="btn btn-sm btn-link text-muted p-0" onclick="alert('Voice input coming soon!')">
                            <span class="material-icons">mic</span>
                        </button>
                    </div>
                    <button class="btn btn-primary-custom rounded-pill px-4 fw-bold shadow-sm"
                        onclick="sendSidebarMessage()">
                        Send <span class="material-icons fs-6 align-middle ms-1">send</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Engagement Helper Modal -->
    <div class="modal fade" id="engagementModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px; overflow:hidden;">
                <div class="modal-header border-0 text-white"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 30px;">
                    <h5 class="modal-title fw-bold d-flex align-items-center gap-2">
                        <span class="material-icons">auto_fix_high</span> Engagement Helper AI
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body p-4 bg-light">

                    <ul class="nav nav-pills mb-3" id="engagementTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active rounded-pill fw-bold px-4" id="upload-tab"
                                data-bs-toggle="tab" data-bs-target="#engagement-upload" type="button" role="tab">1.
                                Upload PDF</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link rounded-pill fw-bold px-4" id="engagement-results-tab"
                                data-bs-toggle="tab" data-bs-target="#engagement-results" type="button" role="tab"
                                disabled>2. Engagement
                                Plan</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="engagementTabContent">
                        <!-- Step 1: Upload -->
                        <div class="tab-pane fade show active" id="engagement-upload" role="tabpanel">
                            <div class="text-center py-5 dashed-border rounded-4 bg-white">
                                <span class="material-icons text-primary mb-3"
                                    style="font-size: 64px;">cloud_upload</span>
                                <h5 class="fw-bold mb-2">Upload Lesson Material</h5>
                                <p class="text-muted mb-4 px-5">Upload your lesson PDF (notes, textbook pages, etc.).
                                    <br>Our AI will analyze it and suggest interactive activities.
                                </p>

                                <input type="file" id="engagement-pdf-input" class="d-none" accept="application/pdf"
                                    onchange="updateEngagementFileName()">
                                <button class="btn btn-primary-custom rounded-pill px-5 py-2 fw-bold shadow-sm"
                                    onclick="document.getElementById('engagement-pdf-input').click()">
                                    Select PDF File
                                </button>
                                <div id="engagement-filename" class="mt-3 fw-bold text-success d-none"></div>
                            </div>
                            <div class="d-flex justify-content-end mt-4">
                                <button class="btn btn-dark fw-bold px-4 rounded-pill"
                                    onclick="analyzeEngagementDocs()">
                                    Analyze & Generate Ideas <span
                                        class="material-icons align-middle ms-1">arrow_forward</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Results -->
                        <div class="tab-pane fade" id="engagement-results" role="tabpanel">
                            <div id="engagement-loader" class="text-center py-5 d-none">
                                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"
                                    role="status"></div>
                                <h5 class="mt-3 fw-bold text-muted">Analyzing content & generating ideas...</h5>
                                <p class="small text-muted">This may take up to 30 seconds.</p>
                            </div>

                            <div id="engagement-content" class="d-none">
                                <!-- Dynamic Content Here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>


</html>